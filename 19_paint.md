{{meta {load_files: ["code/chapter/19_paint.js"], zip: "html include=[\"css/paint.css\"]"}}}

# ูพุฑูฺู: ฺฉ ูุฑุงุดฺฏุฑ ูพฺฉุณู

{{quote {author: "ุฎูุงู ูุฑู", chapter: true}

ุจู ุฑูฺฏโูุง ุจุดูุงุฑ ูพุด ุฑูู ูฺฏุงู ู ฺฉูู. ุจู ุจูู ููุงุด ุฎุงูโุงู ูุฒ. ุขูโฺฏุงูุ ุณุนโ ู ฺฉูู ุฑูฺฏโูุง ุฑุง ูุงููุฏ ูุงฺูโูุง ฺฉู ุดุนุฑโูุง ุฑุง ูโุณุงุฒูุฏ ุจู ฺฉุงุฑ ุจุจุฑูุ ูุงููุฏ ููุชโูุง ฺฉู ุจู ููุณู ุดฺฉู ูโุฏููุฏ.

quote}}

{{index "Miro, Joan", "drawing program example", "project chapter"}}

{{figure {url: "img/chapter_picture_19.jpg", alt: "Picture of a tiled mosaic", chapter: "framed"}}}

ูุฑุขูฺู ุจุฑุง ุณุงุฎุช ฺฉ ุงูพูฺฉุดู ูุจ ุณุงุฏู ููุฑุฏ ูุงุฒ ุงุณุชุ ุฏุฑ ูุตูโูุง ูพุดู ุขูุฏู ุงุณุช. ุฏุฑ ุงู ูุตูุ ููุท ูุฑุงุฑ ุงุณุช ุงุฒ ุขูโูุง ุงุณุชูุงุฏู ฺฉูู.

{{index [file, image]}}

ุงูพูฺฉุดู ูุง ูุฑุงุฑ ุงุณุช ฺฉ ุจุฑูุงููโ ุชุฑุณู ูพฺฉุณู ุจุงุดุฏุ ุฌุง ฺฉู ู ุชูุงูุฏ ฺฉ ุชุตูุฑ
ุฑุง ูพฺฉุณู ุจู ูพฺฉุณู ุชุบุฑ ุฏูุฏ. ุงู ฺฉุงุฑ ุจุง ุฏุณุชฺฉุงุฑ ุญุงูุช ุจุฒุฑฺฏโููุง ุดุฏูโ ุชุตูุฑุ
ฺฉู ุฌุฏูู ุงุฒ ุฎุงููโูุง ุฑูฺฏ ุดุฏู ุงุณุช ุตูุฑุช ู ฺฏุฑุฏ. ู ุชูุงูุฏ ุงุฒ ุขู ุจุฑุง ุจุงุฒ ฺฉุฑุฏู
ูุงูโูุง ุชุตูุฑ ู ุฎุท ุฎุท ฺฉุฑุฏู ุฑู ุขูโูุง ุจุง ููุณ ุง ูุฑ ูุณููโ ุงุดุงุฑูโฺฏุฑ ุฏฺฏุฑ ุงุณุชูุงุฏู ฺฉูุฏ ู ุณูพุณ ุขู ุฑุง ุฐุฎุฑู ููุงุฏ. ุจุฑูุงูู ฺฉุงุฑุจุฑุฏ ูุง ุดุจู ุจู ุชุตูุฑ ุฒุฑ ุฎูุงูุฏ ุจูุฏ:


{{figure {url: "img/pixel_editor.png", alt: "The pixel editor interface, with colored pixels at the top and a number of controls below that", width: "8cm"}}}

ููุงุด ุฑู ฺฉ ฺฉุงููพูุชุฑ ุฎู ุฌุงูุจ ุงุณุช. ูุงุฒ ูุณุช ูฺฏุฑุงู ุงุจุฒุงุฑุ ุชูุงูุง ุง ุงุณุชุนุฏุงุฏ ุฎุงุต ุจุงุดุฏ. ฺฉุงู ุงุณุช ููุท ุดุฑูุน ุจู ฺฉุดุฏู ฺฉูุฏ.

## ูุคูููโูุง ุง ุงุฌุฒุงุก

{{index drawing, "select (HTML tag)", "canvas (HTML tag)", component}}

ุฑุงุจุท ุจุฑูุงููโ ฺฉุงุฑุจุฑุฏ ูุงุ ุดุงูู ฺฉ `<canvas>` ุจุฒุฑฺฏ ุฏุฑ ุจุงูุง ุตูุญู ู ุจุงุดุฏ ฺฉู ฺูุฏู ููุฏ
ูุฑู ูุฒ ุฏุฑ ุฒุฑ ุขู ูุฑุงุฑ ฺฏุฑูุชู ุงุณุช. ฺฉุงุฑุจุฑ ุจุง ุงูุชุฎุงุจ ฺฉ ุงุจุฒุงุฑ ุงุฒ ูุณุช ููุฏ `<select>` ู
ฺฉูฺฉ ฺฉุฑุฏูุ ููุณ ฺฉุฑุฏู ุง ฺฉุดุฏู ููุณ ุฑู ุจูู ุจู ุชุฑุณู ู ูพุฑุฏุงุฒุฏ. ููฺูู ุงุจุฒุงุฑูุง ุจุฑุง ุฑุณู ุชฺฉโูพฺฉุณูโูุงุ ฺูุงุฑุถูุนโูุงุ ุฑูฺฏโฺฉุฑุฏู ฺฉ ูุงุญูุ ู ุงูุชุฎุงุจ ฺฉ ุฑูฺฏ ุงุฒ ุฑู ฺฉ ุชุตูุฑ ูุฌูุฏ ุฏุงุฑุฏ.

{{index [DOM, components]}}

ูุง ุฑุงุจุท ูุฑุงุดฺฏุฑ ุฑุง ุจู ุดฺฉู ุชุนุฏุงุฏ ูุคููู ุณุงุฎุชุงุฑุฏู ู ฺฉููุ ุงุดุงุฆ ฺฉู ูุณุฆูู
ุจุฎุดโูุง ุงุฒ DOM ู ุจุงุดูุฏ ู ููฺฉู ุงุณุช ุญุงู ุฏฺฏุฑ ูุคููู ูุง ุฏุฑ ุฏุฑูู ุฎูุฏ ุจุงุดูุฏ.

{{index [state, "of application"]}}

ูุถุนุช (state) ุจุฑูุงููโ ฺฉุงุฑุจุฑุฏ ุดุงูู ุชุตูุฑ ูุนูุ ุงุจุฒุงุฑ ุงูุชุฎุงุจ ุดุฏู ู ุฑูฺฏ ุงูุชุฎุงุจ ุดุฏู ู
ุจุงุดุฏ. ูุง ฺฉุงุฑูุง ุฑุง ุทูุฑ ุชูุธู ู ฺฉูู ฺฉู ุฏุฑ ูุชุฌู ูุถุนุช ุจุง ฺฉ ููุฏุงุฑ ูุดุฎุต ุดูุฏ ู
ุฏฺฏุฑ ูุคูููโูุง ููุดู ุจุง ุชูุฌู ุจู ูุถุนุช ูุนู ุดฺฉู ุจฺฏุฑูุฏ.

ุจุฑุง ูพ ุจุฑุฏู ุจู ุงููุช ุงู ููุถูุนุ ุงุฌุงุฒู ุจุฏูุฏ ุฑุงู ุฏฺฏุฑ ุฑุง ูู ุจุฑุฑุณ ฺฉูู โ ูพุฎุด ูุณูุชโูุง ูุถุนุช (state)
ุฏุฑ ุณุฑุงุณุฑ ุฑุงุจุท. ุชุง ููุทูโ ูุดุฎุตุ ุงู ุฑูุดุ ุจุฑูุงููโููุณ ุณุงุฏู ุชุฑ
ุฏุงุฑุฏ. ู ุชูุงูู ุชููุง ฺฉ ููุฏ ุฑูฺฏ ุฏุฑ ูุธุฑ ุจฺฏุฑู ู ูุฑ ุฒูุงู ฺฉู ูุงุฒ ุจู ุฏุงูุณุชู ุฑูฺฏ ูุนู ุฏุงุดุชูุ ููุฏุงุฑ ุขู ุฑุง ุจุฎูุงูู.

ุงูุง ุฏุฑ ุงุฏุงูู ุชุตูู ู ฺฏุฑู ฺฉ ฺฏุฒูุดโฺฏุฑ ุฑูฺฏ ุงุถุงูู ฺฉูู โ ุงุจุฒุงุฑ ฺฉู ุจู ุดูุง ุงุฌุงุฒู ู ุฏูุฏ
ุชุง ุจุง ฺฉูฺฉ ุฑู ุชุตูุฑุ ุฑูฺฏ ูพฺฉุณู ุฏุงุฏูโุดุฏู ุฑุง ุงูุชุฎุงุจ ฺฉูุฏ. ุจุฑุง ุงูฺฉู ฺฉุงุฑ ฺฉูู
ุชุง ููุฏ ุฑูฺฏ ุ ุฑูฺฏ ุฏุฑุณุช ุฑุง ููุงุด ุฏูุฏุ ุงุจุฒุงุฑ ูุง ุจุงุณุช ุจุฏุงูุฏ ฺฉู ููุฏ ุฑูฺฏ ููุฑุฏ ูุธุฑ ููุฌูุฏ
ุงุณุช ู ุจุง ูุฑ ุจุงุฑ ุงูุชุฎุงุจ ุฑูฺฏ ุฌุฏุฏ ุขู ุฑุง ุจูโุฑูุฒ ุฑุณุงู ฺฉูุฏ. ุงฺฏุฑ ุฌุง ุฏฺฏุฑ ุฑุง ูุฒ ุฏุฑ ูุธุฑ ฺฏุฑูุชุฏ ฺฉู ุฑูฺฏ ุงูุชุฎุงุจ ุดุฏู ุฑุง ููุงุงู ฺฉูุฏ( ููฺฉู ุงุณุช ุงุดุงุฑูโฺฏุฑ ููุณ ุจุฑุง ุงู ฺฉุงุฑ
ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดุฏู ุจุงุดุฏ)ุ ุจุงุฏ ฺฉุฏ ูุฑุจูุท ุจู ุชุบุฑ ุฑูฺฏ ุฑุง ูุฒ ุจูโุฑูุฒโุฑุณุงู ฺฉูุฏ
ุชุง ุขู ุฌุง ุฌุฏุฏ ุฑุง ูุฒ ููุงููฺฏ ูฺฏู ุฏุงุฑุฏ.

{{index modularity}}

ุฏุฑ ุนููุ ุงู ฺฉุงุฑ ุดูุง ุฑุง ุจุง ูุดฺฉู ุฑูุจุฑู ู ฺฉูุฏ ุทูุฑ ฺฉู ูุฑ ุจุฎุด ุงุฒ ุฑุงุจุท ูุงุฒู ุงุณุช ุชุง
ุฏุฑุจุงุฑูโ ููู ุจุฎุดโูุง ุฏฺฏุฑ ุขฺฏุงู ุจุงุดุฏุ ฺฉู ุฎู ูุงฺููุงุฑ ูุณุช. ุจุฑุง ุจุฑูุงููโูุง ฺฉุงุฑุจุฑุฏ
ฺฉูฺฺฉ ูุซู ููุฑุฏ ุงู ูุตูุ ููฺฉู ุงุณุช ูุดฺฉู ุฎุงุต ูุจุงุดุฏ. ุจุฑุง ูพุฑูฺู ูุง ุจุฒุฑฺฏุชุฑ ู ุชูุงูุฏ ุงู
ฺฉุงุฑ ุจู ฺฉุงุจูุณ ุจุฒุฑฺฏ ุฎุชู ุดูุฏ.

ุฎูุจ ุจุฑุง ูพุดฺฏุฑ ุงุฒ ุจุฑูุฒ ุงู ฺฉุงุจูุณุ ูุง ุณุน ู ฺฉูู ฺฉู ุฏุฑ ููุฑุฏ ุฌุฑุงู ุฏุงุฏู (data flow) ุฎู
ุณุฎุชฺฏุฑุงูู ุนูู ฺฉูู. ฺฉ ูุถุนุช ูุฌูุฏ ุฏุงุฑุฏ ู ุฑุงุจุท ูุฑุงุฑ ุงุณุช ุจุฑ ุงุณุงุณ ุขู ูุถุนุช ุชุฑุณู
ุดูุฏ. ฺฉ ูุคูููโ ุฑุงุจุท ููฺฉู ุงุณุช ุจู ฺฉุงุฑูุง ฺฉุงุฑุจุฑ ุจุง ุจูโุฑูุฒ ุฑุณุงู ูุถุนุช ูพุงุณุฎ ุฏูุฏุ ฺฉู
ุฏุฑ ุขู ููุทูโุ ูุคูููโูุง ุดุงูุณ ุฏุงุฑูุฏ ุชุง ุฎูุฏุดุงู ุฑุง ุจุง ูุถุนุช ุฌุฏุฏ ููุงููฺฏ ุณุงุฒูุฏ.

{{index library, framework}}

ุฏุฑ ุนููุ ูุฑ ูุคููู ุจู ฺฏูููโุง ุชูุธู ู ุดูุฏ ฺฉู ุฒูุงู ฺฉู ุจู ุขู ูุถุนุช ุฌุฏุฏ ุฏุงุฏู
ุดูุฏุ ุงู ูุถุนุช ุฑุง ุจู ูุคูููโูุง ูุฑุฒูุฏุด ูุฒ ุงุนูุงู ฺฉูุฏ ุชุง ุขูโโูุง ฺฉู ูุงุฒ ุฏุงุฑูุฏ ุจูโุฑูุฒ
ุดููุฏ. ุฏุฑุณุช ฺฉุฑุฏู ุงู ูุณูุช ฺฉู ุจุง ุฒุญูุช ููุฑุงู ุงุณุช. ุงุฌุฑุง ููุงุณุจ ู ุฑุงุญุช ุงู ุจุฎุดุ ูุฒุช
ู ููุทูโ ุจุฑุชุฑ ุฎู ุงุฒ ฺฉุชุงุจุฎุงููโูุง ูุฑุจูุท ุจู ุจุฑูุงูู ููุณ ูุฑูุฑฺฏุฑ ูุญุณูุจ ู ุดูุฏ. ุงูุง
ุจุฑุง ุจุฑูุงููโ ฺฉูฺฺฉ ูุซู ุจุฑูุงููโ ูุง ุ ู ุชูุงูู ุจุฏูู ุฏุงุดุชู ุงู ุฒุฑุณุงุฎุช ูุฒ ุฌูู
ุจุฑูู.

{{index [state, transitions]}}

ุจูโุฑูุฒ ุฑุณุงูโูุง ูุถุนุช ุจู ุดฺฉู ุงุดุงุก ููุงุด ุฏุงุฏู ู ุดููุฏ ฺฉู ูุง ุขู ูุง ุฑุง actions ู
ูุงูู. ูุคูููโูุง ููฺฉู ุงุณุช ุงู ฺฏููู ุงฺฉุดู ูุง ุฑุง ุงุฌุงุฏ ฺฉููุฏ ู ฺฏุณู  (_((dispatch))_) ุฏููุฏ โ
ุขู ูุง ุฑุง ุจู ุชุงุจุน ูุฑฺฉุฒ ูุฏุฑุช ูุถุนุช ุงุฑุณุงู ููุงูุฏ. ุขู ุชุงุจุน ูุถุนุช ุจุนุฏ ุฑุง ูุญุงุณุจู ู
ฺฉูุฏ ฺฉู ูพุณ ุงุฒ ุขู ุ ูุคูููโูุง ุฑุงุจุทุ ุฎูุฏุดุงู ุฑุง ุจู ูุถุนุช ุฌุฏุฏ ุจูโุฑูุฒ ุฑุณุงู ูโฺฉููุฏ.

{{index [DOM, components]}}

ูุง ุฏุฑ ุญุงู ูพุฑุฏุงุฎุชู ุจู ุจุฎุด ูพุฑฺฉุงุฑ ุงุฌุฑุง ฺฉ ุฑุงุจุท ฺฉุงุฑุจุฑ ู ุงุนูุงู ุณุงุฎุชุงุฑ ุจู ุขู ูุณุชู.
ุงฺฏุฑฺู ุจุฎุดโูุง ูุฑุชุจุท ุจุง DOM ูููุฒ ูพุฑ ุงุฒ ุงุซุฑุงุช ุฌุงูุจ ูุณุชูุฏุ ุจุง ุงู ูุฌูุฏ ุชูุณุท ฺฉ ุฒุฑุณุงุฎุช
ููููู ุณุงุฏู ูฺฏูุฏุงุฑ ู ุดููุฏ โ ฺุฑุฎูโ ุจูโุฑูุฒ ุฑุณุงู ูุถุนุช. ูุถุนุช ูุดุฎุต ู ฺฉูุฏ ฺฉู DOM
ฺฺฏููู ุธุงูุฑ ุงุจุฏุ ู ุชููุง ุฑุงู ฺฉู ุฑุฎุฏุงุฏูุง DOM ุฏุงุฑูุฏ ุจุฑุง ุชุบุฑ ูุถุนุช ุงู ุงุณุช ฺฉู
ุงฺฉุดูโูุง ุฑุง ุจู ูุถุนุช ููุฑุฏ ูุธุฑ ฺฏุณู ุฏููุฏ.

{{index "data flow"}}

ุฑุงูโูุง ุฒุงุฏ ุจุฑุง ุงูุฌุงู ุงู ฺฉุงุฑ ูุฌูุฏ ุฏุงุฑุฏ ฺฉู ูุฑ ฺฉุฏุงู ูุฒุงุง ู ูุนุงุจ ุฎูุฏุดุงู ุฑุง ุฏุงุฑูุฏุ ุงูุง ุงุฏูโ ุงุตู ูููโ ุขู ูุง ูุดุชุฑฺฉ ุงุณุช: ุชุบุฑุงุช ูุถุนุช ุจุงุณุช ุงุฒ ุทุฑู ฺฉ ฺฉุงูุงู ฺฏุงููโ ูุดุฎุต ุงูุฌุงู ุดูุฏ ูู ุฏุฑ ูููโ ูุณูุชโูุง ููุฌูุฏ.

{{index "dom property", [interface, object]}}

ูุคูููโูุง ูุง ฺฉูุงุณ ูุง ุฎูุงููุฏ ุจูุฏ ฺฉู ุจุง ฺฉ ุฑุงุจุท ูุทุงุจูุช ุฏุงุฑูุฏ. ุณุงุฒูุฏูโ ุขู ูุง ุ
ูุถุนุช ุฑุง ุฏุฑุงูุช ู ฺฉูุฏ ฺฉู ููฺฉู ุงุณุช ูุถุนุช ฺฉู ุจุฑูุงูู ุจุงุดุฏ ุง ุจุฎุด ุงุฒ ุขู ุงฺฏุฑ
ูุงุฒ ุจู ุฏุณุชุฑุณ ุจู ููู ฺุฒ ูุณุช ู ุงุฒ ุขู ุจุฑุง ุณุงุฎุชู ุฎุงุตุช `dom` ุงุณุชูุงุฏู ู ฺฉูุฏุ
DOMุง ฺฉู ููุงุงูฺฏุฑ ูุคููู ู ุจุงุดุฏ. ุงุบูุจ ุณุงุฒูุฏูโูุง ููุฏุงุฑูุง ุฏฺฏุฑ ุฑุง ูุฒ ุฏุฑุงูุช ู
ฺฉููุฏ ฺฉู ุฏุฑ ุทูู ุฒูุงู ุซุงุจุช ูุณุชูุฏ ูุงููุฏ ุชุงุจุน ฺฉู ู ุชูุงููุฏ ุงุฒ ุขู ุจุฑุง ฺฏุณู ฺฉ ุงฺฉุดู
ุงุณุชูุงุฏู ฺฉููุฏ.

{{index "syncState method"}}

ูุฑ ูุคููู ุฏุงุฑุง ูุชุฏ ุจู ูุงู `syncState` ู ุจุงุดุฏ ฺฉู ุจุฑุง ููุงููฺฏโุณุงุฒ ุขู ุจุง ฺฉ ููุฏุงุฑ
ูุถุนุช ุฌุฏุฏ ุงุณุชูุงุฏู ู ุดูุฏ. ุงู ูุชุฏ ฺฉ ุขุฑฺฏููุงู ุฏุฑุงูุช ู ฺฉูุฏุ ูุถุนุชุ ฺฉู ุงุฒ ููุน
ูุดุงุจู ุงููู ุขุฑฺฏููุงู ุณุงุฒูุฏูโุงุด ู ุจุงุดุฏ.

## ูุถุนุช ุง State

{{index "Picture class", "picture property", "tool property", "color property", "Matrix class"}}

ูุถุนุช ุจุฑูุงูู ุดุฆ ุฎูุงูุฏ ุจูุฏ ฺฉู ุฏุงุฑุง ุฎุงุตุชโูุง `pictureุ` `toolุ` ู `color` ู ุจุงุดุฏ.
picture ุฎูุฏุด ูุฒ ฺฉ ุด ุงุณุช ฺฉู ุทููุ ุงุฑุชูุงุน ู ูุญุชูุง ูพฺฉุณู ุชุตูุฑ ุฑุง ุฐุฎุฑู ู
ููุงุฏ. ูพฺฉุณูโูุง ุฏุฑูู ฺฉ ุขุฑุงู ุฐุฎุฑู ู ุดููุฏ ุจู ููุงู ุดฺฉู ฺฉู ฺฉูุงุณ ูุงุชุฑุณ ุงุฒ[ูุตู
?](object)
ุนูู ู ฺฉุฑุฏ โ ุฑุฏู ุจู ุฑุฏู ู ุงุฒ ุจุงูุง ุจู ูพุงู.

```{includeCode: true}
class Picture {
  constructor(width, height, pixels) {
    this.width = width;
    this.height = height;
    this.pixels = pixels;
  }
  static empty(width, height, color) {
    let pixels = new Array(width * height).fill(color);
    return new Picture(width, height, pixels);
  }
  pixel(x, y) {
    return this.pixels[x + y * this.width];
  }
  draw(pixels) {
    let copy = this.pixels.slice();
    for (let {x, y, color} of pixels) {
      copy[x + y * this.width] = color;
    }
    return new Picture(this.width, this.height, copy);
  }
}
```

{{index "side effect", "persistent data structure"}}

ูุตุฏ ูุง ุงู ุงุณุช ฺฉู ุจุชูุงูู ุจุง ุชุตูุฑ ูุงููุฏ ฺฉ ููุฏุงุฑ ุบุฑ ูุงุจู ุชุบุฑ ุฑูุชุงุฑ ฺฉูู ุจู
ุฏูุงู ฺฉู ุจุนุฏุง ุฏุฑ ุงุฏุงูู ูุตู ุฎูุงูู ฺฏูุช. ุงูุง ฺฏุงู ูุฒ ูุงุฒู ุงุณุช ุชุง ุจุฎุด ุงุฒ ูพฺฉุณูโูุง
ุฑุง ฺฉุฌุง ุชุบุฑ ุฏูู. ุจุฑุง ุงู ฺฉู ุจุชูุงูู ุงู ฺฉุงุฑ ุฑุง ุงูุฌุงู ุฏูู ฺฉูุงุณ ูุง ูุชุฏ ุจู
ูุงู `draw` ุฏุงุฑุฏ ฺฉู ุขุฑุงูโุง ุฑุง ูโฺฏุฑุฏ ฺฉู ุดุงูู ูพฺฉุณูโูุง ุชุบุฑ ุงูุชู ูโุจุงุดุฏ โ
ุงุดุงุฆ ุจุง ุฎุงุตุชโูุง `x` ุ `y` ู `color` โ ู ุชุตูุฑ ุฌุฏุฏ ุจุง ุขู ูพฺฉุณูโูุง ุจุงุฒููุณ ุดุฏู
ุงุฌุงุฏ ฺฉูุฏ. ุงู ูุชุฏ ุงุฒ `slice` ุจุฏูู ุงุณุชูุงุฏู ุงุฒ ุขุฑฺฏููุงู ุจูุฑู ู ุจุฑุฏ ุชุง ุชูุงู ุขุฑุงูโ
ูพฺฉุณูโูุง ุฑุง ฺฉูพ ฺฉูุฏ โ ุดุฑูุน slice ุจู ุตูุฑุช ูพุดูุฑุถ ุจุฑุงุจุฑ 0 ู ููุฏุงุฑ ูพุดโูุฑุถ ุงูุชูุง ุขู ุทูู ุขุฑุงู ู
ุจุงุดุฏ.

{{index "Array constructor", "fill method", ["length property", "for array"], [array, creation]}}

ูุชุฏ `empty` ุงุฒ ุฏู ูฺฺฏ ุขุฑุงูโูุง ุจูุฑู ู ุจุฑุฏ ฺฉู ุชุงฺฉููู ูุดุงูุฏู ูฺฉุฑุฏู ุงู. ุณุงุฒูุฏู
`Array` ุฑุง ู ุชูุงู ุจุง ฺฉ ุนุฏุฏ ุจุฑุง ุณุงุฎุช ฺฉ ุขุฑุงู ุชู ุจุง ุทูู ูุดุฎุต ูุฑุงุฎูุงู ฺฉุฑุฏ. ู
ูุชุฏ `fill` ุฑุง ู ุชูุงู ุจุฑุง ูพุฑ ฺฉุฑุฏู ุงู ุขุฑุงู ุจุง ฺฉ ููุฏุงุฑ ูุดุฎุต ุงุณุชูุงุฏู ฺฉุฑุฏ. ุงู
ูุชุฏูุง ุจุฑุง ุณุงุฎุชู ุขุฑุงูโุง ฺฉู ุฏุฑ ุขู ูููโ ูพฺฉุณูโูุง ุฑูฺฏ ูุดุงุจู ุฏุงุฑูุฏ ุงุณุชูุงุฏู ู ุดูุฏ.

{{index "hexadecimal number", "color component", "color field", "fillColor property"}}

ุฑูฺฏโูุง ุจู ุนููุงู ุฑุดุชูโูุง ฺฉู ุญุงู ฺฉุฏูุง ุฑูฺฏ ูุนููู ุฏุฑ CSS ู ุจุงุดูุฏ โ ฺฉ ุนูุงูุช ูุด
(`#`) ฺฉู ุจุนุฏ ุงุฒ ุขู ุดุด ุฑูู ูฺฏุฒุงุฏุณูุงู (ูุจูุง 16) ูุฑุงุฑ ู ฺฏุฑุฏุ ุฏู ุฑูู ุจุฑุง ุฌุฒุก
ูุฑูุฒุ ุฏู ุฑูู ุจุฑุง ุณุจุฒ ู ุฏู ุฑูู ุจุฑุง ุจุฎุด ุขุจ โ ุฐุฎุฑู ู ุดููุฏ. ุงู ุดููโ ููุดุชู
ุฑูฺฏ ูุง ููุฏุงุฑ ุฑูุฒฺฏููู ู ูุงููุงุณุจ ุจู ูุธุฑ ู ุฑุณุฏ ุงูุง ุงู ูุฑูุช ุงุณุช ฺฉู ููุฏูุง ูุฑูุฏ
ุฑูฺฏ ุฏุฑ HTML ุงุณุชูุงุฏู ู ฺฉููุฏ ู ู ุชูุงู ุงุฒ ุขู ุจุฑุง ุฎุงุตุช `fillColor` ูุฑุจูุท ุจู ุจุณุชุฑ (context)
ุชุฑุณู ุฏุฑ canvas ุงุณุชูุงุฏู ฺฉุฑุฏ. ุจูุงุจุฑุงู ุฏุฑ ุฌุง ฺฉู ูุตุฏ ุงุณุชูุงุฏู ุงุฒ ุฑูฺฏโูุง ุฏุฑ ุงู
ุจุฑูุงูู ุฑุง ุฏุงุฑูุ ููุงุณุจ ูุณุชูุฏ.

{{index black}}

ุฑูฺฏ ุณุงูุ ุฒูุงู ุงุชูุงู ู ุงูุชุฏ ฺฉู ูููโ ุงุฌุฒุง ุฑูฺฏ ุจุฑุงุจุฑ ุตูุฑ ุจุงุดูุฏ ู ุจู ุตูุฑุช <bdo>`"#000000"`</bdo> ููุดุชู ู ุดูุฏ ุ ู ุฑูฺฏ ุตูุฑุช
ุฑูุดู ุดุจู ุจู <bdo>`"#ff00ff"`</bdo> ููุดุชู ู ุดูุฏุ ุจู ุตูุฑุช ฺฉู ูุณูุช ุฑูฺฏ ูุฑูุฒ ู ุขุจ ุฏุฑ ุขู ุฏุฑ ุจุดููโ ููุฏุงุฑ ุฎูุฏุ 255ุ ูุณุชูุฏ ฺฉู ุจู ุตูุฑุช `ff` ุฏุฑ ูฺฏุฒุงุฏุณูุงู ููุดุชู ู ุดูุฏ ( ฺฉู ุงุฒ _a_ ุชุง _f_ ุฑุง ุจู ุนููุงู ุงุฑูุงู ูุนุงุฏู 10 ุชุง 15 ุฏุฑ ูุธุฑ ู ฺฏุฑูุฏ).

{{index [state, transitions]}}

ูุง ุจู ุฑุงุจุท ฺฉุงุฑุจุฑ ุงู ุงูฺฉุงู ุฑุง ู ุฏูู ฺฉู actionูุง ุฑุง ุจู ุนููุงู ุงุดุงุฆ ฺฏุณู (dispatch) ุฏูุฏ ฺฉู ุฎุงุตุชโูุงุดุงูุ ุฎุงุตุชโูุง ูุถุนุช ูุจู ุฑุง ุจุงุฒููุณ ู ฺฉููุฏ. ููุฏ ุฑูฺฏุ ุฒูุงู ฺฉู ฺฉุงุฑุจุฑ ุขู ุฑุง ุชุบุฑ ู ุฏูุฏุ ู ุชูุงูุฏ ุดุฆ ูุซู `{color: field.value}` ุฑุง ฺฏุณู ุฏูุฏ ฺฉู ุงุฒ ุขูุ ุชุงุจุน ุจูโุฑูุฒ ุฑุณุงู ุฒุฑ ู ุชูุงูุฏ ููุฏุงุฑ ุฌุฏุฏ ุฑุง ูุญุงุณุจู ฺฉูุฏ.

{{index "updateState function"}}

```{includeCode: true}
function updateState(state, action) {
  return Object.assign({}, state, action);
}
```

{{index "period character", spread, "Object.assign function"}}

ุงู ุงูฺฏู ูุณุจุชุง ูพฺุฏูุ ฺฉู ุฏุฑ ุขู ุงุฒ `Object.assign` ุจุฑุง ุงูุฒูุฏู ุฎุงุตุชโูุง `state` ุจู ฺฉ ุดุก ุฎุงู ุฏุฑ ุงุจุชุฏุง ุงุณุชูุงุฏู ู ฺฉูุฏ ู ุจุนุฏ ุจุนุถ ุงุฒ ุขู ูุง ุฑุง ุจุง ุฎุงุตุชโูุง ุงุฒ `action` ุจุงุฒููุณ ู ฺฉูุฏุ ุฏุฑ ฺฉุฏูุง ุฌุงูุงุงุณฺฉุฑูพุช ฺฉู ุงุฒ ุงุดุงุก ุบุฑูุงุจู ุชุบุฑ ุงุณุชูุงุฏู ู ฺฉููุฏ ูุนููู ุงุณุช. ุฑูุด ุฑุงุญุช ู ููุงุณุจ ุชุฑ ุงู ฺฉุงุฑ ฺฉู ุฏุฑ ุขู ุงุฒ ุนููฺฏุฑ ุณู ููุทู ุงุณุชูุงุฏู ู ุดูุฏ ุชุง ูููโ ุฎุงุตุชโูุง ุดุก ุฏฺฏุฑ ุฑุง ุฏุฑ ฺฉ ุนุจุงุฑุช ุดุก ูุฑุงุฑ ุฏูุฏุ ุฏุฑ ุขุฎุฑู ูุฑุงุญู ุงุณุชุงูุฏุงุฑุฏ ุดุฏู ุฏุฑ ุฌุงูุงุงุณฺฉุฑูพุช ุจู ุณุฑ ู ุจุฑุฏ. ุจุง ุงู ูฺฺฏุ ู ุชูุงูุณุชุฏ ุจู ุฌุง ุดฺฉู ูุจูุ ุจููุณุฏ `{...state, ...action}`. ุฏุฑ ุฒูุงู ููุดุชู ุงู ฺฉุชุงุจุ ุงู ูฺฺฏ ูููุฒ ุฏุฑ ูููโ ูุฑูุฑฺฏุฑูุง ูพุดุชุจุงู ูู ุดูุฏ.

## ุณุงุฎุชู DOM

{{index "createElement method", "elt function", [DOM, construction]}}

ฺฉ ุงุฒ ฺฉุงุฑูุง ุงุตู ฺฉู ูุคูููโูุง ุฑุงุจุท ฺฉุงุฑุจุฑ ุงูุฌุงู ู ุฏููุฏ ุณุงุฎุช ุณุงุฎุชุงุฑ DOM ุงุณุช. ูุง ูุตุฏ ูุฏุงุฑู ฺฉู ุฏูุจุงุฑู ุจู ุตูุฑุช ูุณุชูู ุงุฒ ูุชุฏูุง ุตุฑุญ DOM ุจุฑุง ุงู ฺฉุงุฑ ุงุณุชูุงุฏู ฺฉููุ ุจูุงุจุฑุงู ูุณุฎูโุง ุงุฒ ุชุงุจุน `elt` ฺฉู ฺฉู ุชูุณุนู ุงูุชู ุงุณุช ุฑุง ุจู ฺฉุงุฑ ุฎูุงูู ุจุฑุฏ:

```{includeCode: true}
function elt(type, props, ...children) {
  let dom = document.createElement(type);
  if (props) Object.assign(dom, props);
  for (let child of children) {
    if (typeof child != "string") dom.appendChild(child);
    else dom.appendChild(document.createTextNode(child));
  }
  return dom;
}
```

{{index "setAttribute method", "attribute", "onclick property", "click event", "event handling"}}

ุชูุงูุช ุงุตู ุจู ุงู ูุณุฎู ู ูุณุฎูโุง ฺฉู ุงุฒ ุขู ุฏุฑ [ูุตู ?](game#domdisplay) ุงุณุชูุงุฏู ฺฉุฑุฏู ุงู ุขู ุงุณุช ฺฉู ุงู ูุณุฎู ุฎุงุตุชโูุง ุฑุง ุจู ฺฏุฑูโูุง DOM ุงุฎุชุตุงุต ู ุฏูุฏ ูู ุจู attributes. ุงู ุจุฏุงู ูุนู ุงุณุช ฺฉู ูู ุชูุงูู ุงุฒ ุขู ุจุฑุง ุชูุธู ุฎุตุตูโูุง (attribute) ุฏูุฎูุงู ุงุณุชูุงุฏู ฺฉููุ ุงูุง ู ุชูุงูู ุงุฒ ุขู ุจุฑุง ุชูุธู ุฎุงุตุชโูุง ฺฉู ููุฏุงุฑุดุงู ุฑุดุชูโุง ูุณุช ุงุณุชูุงุฏู ฺฉูู ูุงููุฏ `onclick`ุ ฺฉู ูโุชูุงูุฏ ุชุงุจุน ุฑุง ุจู ุนููุงู ฺฏุฑุฏุงููุฏูโ ุฑุฎุฏุงุฏ ฺฉูฺฉ ุซุจุช ฺฉูุฏ.

{{index "button (HTML tag)"}}

ุงู ุจุงุนุซ ู ุดูุฏ ฺฉู ุงู ุณุจฺฉ ุงุฒ ุซุจุช ฺฏุฑุฏุงููุฏูโูุง ุฑุฎุฏุงุฏ ูุฌุงุฒ ุดูุฏ:

```{lang: "text/html"}
<body>
  <script>
    document.body.appendChild(elt("button", {
      onclick: () => console.log("click")
    }, "The button"));
  </script>
</body>
```

## canvas

ุงููู ูุคููู ุง ฺฉู ุชุนุฑู ุฎูุงูู ฺฉุฑุฏ ุจุฎุด ุงุฒ ุฑุงุจุท ุฎูุงูุฏ ุจูุฏ ฺฉู ูุฑุงุฑ ุงุณุช ุชุตูุฑ ุฑุง
ุจู ุตูุฑุช ุฌุฏูู ุงุฒ ูุฑุจุนโูุง ุฑูฺฏ ุดุฏู ูุดุงู ุฏูุฏ. ุงู ูุคููู ูุณุฆูู ุฏู ฺฉุงุฑ ู ุจุงุดุฏ: ููุงุด
ฺฉ ุชุตูุฑ ู ุงุฌุงุฏ ุชุนุงูู ุจู ุฑุฎุฏุงุฏูุง ูุฑุจูุท ุจู ุงุดุงุฑูโฺฏุฑ ู ุฏฺฏุฑ ูุณูุชโูุง ุจุฑูุงููโ
ฺฉุงุฑุจุฑุฏ.

{{index "PictureCanvas class", "callback function", "scale constant", "canvas (HTML tag)", "mousedown event", "touchstart event", [state, "of application"]}}

ูููุทูุฑุ ู ุชูุงูู ุขู ุฑุง ุจู ุตูุฑุช ฺฉ ูุคููู ฺฉู ููุท ุงุทูุงุนุงุช ุฏุฑ ููุฑุฏ ุชุตูุฑ ูุนู
ุฏุงุฑุฏ ุชุนุฑู ฺฉููุ ูู ุฏุฑุจุงุฑูโ ูุถุนุช ฺฉู ุจุฑูุงูู. ุจู ุฏูู ุงูฺฉู ุงู ูุคููู ูู ุฏุงูุฏ
ฺฉู ุจุฑูุงูู ุจู ุตูุฑุช ฺฉู ฺฺฏููู ฺฉุงุฑ ู ฺฉูุฏุ ูุงุฏุฑ ูุณุช ุชุง ุงฺฉุดูโูุง ุฑุง ูุณุชููุง ฺฏุณู ุฏูุฏ.
ุฏุฑ ุนูุถุ ุฏุฑ ุฒูุงู ูพุงุณุฎ ุจู ุฑุฎุฏุงุฏูุง ุงุดุงุฑูโฺฏุฑุ ุชุงุจุน callbackุง ุฑุง ูุฑุงุฎูุงู ู ฺฉูุฏ ฺฉู
ุชูุณุท ฺฉุฏ ฺฉู ุขู ุฑุง ุจู ูุฌูุฏ ุขูุฑุฏู ูุฑุงูู ุดุฏู ุงุณุชุ ฺฉู ุจุฎุดโูุง ูุฑุจูุท ุจู ุจุฑูุงูู ุฑุง
ูุฏุฑุช ู ฺฉูุฏ.

```{includeCode: true}
const scale = 10;

class PictureCanvas {
  constructor(picture, pointerDown) {
    this.dom = elt("canvas", {
      onmousedown: event => this.mouse(event, pointerDown),
      ontouchstart: event => this.touch(event, pointerDown)
    });
    this.syncState(picture);
  }
  syncState(picture) {
    if (this.picture == picture) return;
    this.picture = picture;
    drawPicture(this.picture, this.dom, scale);
  }
}
```

{{index "syncState method", efficiency}}

ูุฑ ูพฺฉุณู ุฑุง ุจุง ูุฑุจุนูุง 10 ุฏุฑ 10 ุฑุณู ู ฺฉููุ ููุงูุทูุฑ ฺฉู ุฏุฑ ุซุงุจุช `scale` ูุดุฎุต ุดุฏู ุงุณุช. ุจุฑุง ุงุฌุชูุงุจ ุงุฒ ฺฉุงุฑ ุงุถุงูุ ูููููุ ุชุตูุฑ ูุนู ุงุด ุฑุง ุญูุธ ู ุฑุตุฏ ู ฺฉูุฏ ู ููุท ุฒูุงู ุจุงุฒ ุชุฑุณู ุฑุง ุงูุฌุงู ู ุฏูุฏ ฺฉู ุชุตูุฑ ุฌุฏุฏ ุจู `syncState` ุฏุงุฏู ุดูุฏ.

{{index "drawPicture function"}}

ุชุงุจุน ุงุตู ฺฉู ูุณุฆูู ุชุฑุณู ุงุณุช ุ ุงูุฏุงุฒูโ ุจูู ุฑุง ุจุฑุงุณุงุณ ุงูุฏุงุฒูโ ุชุตูุฑ ู ุซุงุจุช ููุงุณ
ุชูุธู ู ฺฉูุฏ ู ุขู ุฑุง ุจุง ูุฑุจุนโูุง ูพุฑ ู ฺฉูุฏุ ฺฉ ูุฑุจุน ุจู ุงุฒุง ูุฑ ูพฺฉุณู.

```{includeCode: true}
function drawPicture(picture, canvas, scale) {
  canvas.width = picture.width * scale;
  canvas.height = picture.height * scale;
  let cx = canvas.getContext("2d");

  for (let y = 0; y < picture.height; y++) {
    for (let x = 0; x < picture.width; x++) {
      cx.fillStyle = picture.pixel(x, y);
      cx.fillRect(x * scale, y * scale, scale, scale);
    }
  }
}
```

{{index "mousedown event", "mousemove event", "button property", "buttons property", "pointerPosition function"}}

ุฒูุงู ฺฉู ุฏฺฉููโ ฺูพ ููุณ ูุดุฑุฏู ุดูุฏ ุฏุฑ ุญุงูฺฉู ุงุดุงุฑูโฺฏุฑ ุฑู ุชุตูุฑ ุงุณุชุ ูุคููู ุชุงุจุน `pointerDown` ุฑุง ูุฑุงุฎูุงู ู ฺฉูุฏ ู ูููุนุช ูฺฉุงู ูพฺฉุณู ฺฉู ุฑู ุขู ฺฉูฺฉ ุดุฏู ุฑุง ุจู ุขู ุงุฑุณุงู ู ููุงุฏ- ุฏุฑ ูุฎุชุตุงุช ุชุตูุฑ. ุงู ฺฉุงุฑ ุจุฑุง ูพุงุฏูโุณุงุฒ ุชุนุงููุงุช ููุณ ุจุง ุชุตูุฑ ุงุณุชูุงุฏู ู ุดูุฏ. ุชุงุจุน callback ููฺฉู ุงุณุช callback ุฏฺฏุฑ ุฑุง ุจุงุฒฺฏุฑุฏุงูุฏ ุชุง ุงุฒ ุญุฑฺฉุช ุงุดุงุฑูโฺฏุฑ ุจู ูพฺฉุณู ุฏฺฏุฑ ุขฺฏุงู ุดูุฏ ุฏุฑ ุญุงูฺฉู ุฏฺฉููโ ููุณ ูพุงู ูฺฏู ุฏุงุดุชู ุดุฏู ุงุณุช.

```{includeCode: true}
PictureCanvas.prototype.mouse = function(downEvent, onDown) {
  if (downEvent.button != 0) return;
  let pos = pointerPosition(downEvent, this.dom);
  let onMove = onDown(pos);
  if (!onMove) return;
  let move = moveEvent => {
    if (moveEvent.buttons == 0) {
      this.dom.removeEventListener("mousemove", move);
    } else {
      let newPos = pointerPosition(moveEvent, this.dom);
      if (newPos.x == pos.x && newPos.y == pos.y) return;
      pos = newPos;
      onMove(newPos);
    }
  };
  this.dom.addEventListener("mousemove", move);
};

function pointerPosition(pos, domNode) {
  let rect = domNode.getBoundingClientRect();
  return {x: Math.floor((pos.clientX - rect.left) / scale),
          y: Math.floor((pos.clientY - rect.top) / scale)};
}
```

{{index "getBoundingClientRect method", "clientX property", "clientY property"}}

ฺูู ูุง ุงูุฏุงุฒูโ ูพฺฉุณูโูุง ุฑุง ู ุฏุงูู ู ู ุชูุงูู ุงุฒ ุชุงุจุน `getBoundingClientRect` ุจุฑุง ูพุฏุง ฺฉุฑุฏู ูููุนุช ุจูู ุฑู ุตูุญู ุงุณุชูุงุฏู ฺฉููุ ู ุชูุงู ุงุฒ ูุฎุชุตุงุช ุฑุฎุฏุงุฏ ููุณ (`clientX` ู `clientY`) ุจู ูุฎุชุตุงุช ุชุตูุฑ ุฏุณุช ูพุฏุง ฺฉุฑุฏ. ุงู ุงุนุฏุงุฏ ููุดู ุฑูุฏ ู ุดููุฏ ูพุณ ุจู ฺฉ ูพฺฉุณู ูุดุฎุต ุงุดุงุฑู ู ฺฉููุฏ.

{{index "touchstart event", "touchmove event", "preventDefault method"}}

ุจุง ุฑุฎุฏุงุฏูุง ูุฑุจูุท ุจู ููุณุ ู ุจุงุณุช ฺฉุงุฑ ูุดุงุจู ุงูุฌุงู ุฏููุ ุงูุง ุจุง ุงุณุชูุงุฏู ุงุฒ ุฑุฎุฏุงุฏูุง ูุชูุงูุช ู ุงุทููุงู ุงุฒ ุงูฺฉู `preventDefault` ุฑุง ุฑู `touchstart` ูุฑุงุฎูุงู ฺฉุฑุฏู ุจุงุดู ุชุง ุงุฒ ุฌุงุจุฌุง ุชุตูุฑ (panning) ุฌููฺฏุฑ ุดูุฏ.

```{includeCode: true}
PictureCanvas.prototype.touch = function(startEvent,
                                         onDown) {
  let pos = pointerPosition(startEvent.touches[0], this.dom);
  let onMove = onDown(pos);
  startEvent.preventDefault();
  if (!onMove) return;
  let move = moveEvent => {
    let newPos = pointerPosition(moveEvent.touches[0],
                                 this.dom);
    if (newPos.x == pos.x && newPos.y == pos.y) return;
    pos = newPos;
    onMove(newPos);
  };
  let end = () => {
    this.dom.removeEventListener("touchmove", move);
    this.dom.removeEventListener("touchend", end);
  };
  this.dom.addEventListener("touchmove", move);
  this.dom.addEventListener("touchend", end);
};
```

{{index "touches property", "clientX property", "clientY property"}}

ุจุฑุง ุฑุฎุฏุงุฏูุง ููุณุ `clientX` ู `clientY` ูุณุชููุง ุฑู ุดุก ุฑุฎุฏุงุฏ ุฏุฑ ุฏุณุชุฑุณ ูุณุชูุฏุ ุงูุง ู ุชูุงูู ุงุฒ ูุฎุชุตุงุช ุดุก ุงููู ููุณ ุฏุฑ ุฎุงุตุช `touches` ุงุณุชูุงุฏู ฺฉูู.

## ุจุฑูุงููโ ฺฉุงุฑุจุฑุฏ

ุจุฑุง ุงูฺฉู ุจุชูุงู ุจุฑูุงูู ุฑุง ุฌุฒ ุจู ุฌุฒ ุณุงุฎุชุ ูุคูููโ ุงุตู ุฑุง ุจู ุนููุงู ฺฉ ูพูุณุชู ุญูู ฺฉ ุจูู ุชุตูุฑ ูพุงุฏู ุณุงุฒ ู ฺฉูู ู ูุฌููุนูโุง ูพูุง ุงุฒ ุงุจุฒุงุฑูุง ู ฺฉูุชุฑูโูุง ุฑุง ุจู ุณุงุฒูุฏูโุงุด ุงุฑุณุงู ู ฺฉูู.

ฺฉูุชุฑูโูุงุ ููุงู ุนูุงุตุฑ ููุฌูุฏ ุฏุฑ ุฑุงุจุท ฺฉุงุฑุจุฑ ูุณุชูุฏ ฺฉู ุฏุฑ ุฒุฑ ุชุตูุฑ ูุฑุงุฑ ู ฺฏุฑูุฏ. ุขูโูุง
ุจู ุดฺฉู ุขุฑุงูโุง ุงุฒ ุณุงุฒูุฏูโูุง ูุคููู ุฏุฑ ุฏุณุชุฑุณ ูุฑุงุฑ ู ฺฏุฑูุฏ.


{{index "br (HTML tag)", "flood fill", "select (HTML tag)", "PixelEditor class", dispatch}}

ุงุจุฒุงุฑูุง ฺฉุงุฑูุง ูุซู ุชุฑุณู ูพฺฉุณูโูุง ุง ุฑูฺฏโฺฉุฑุฏู ฺฉ ูุณูุช ุฑุง ุงูุฌุงู ูโุฏููุฏ. ุจุฑูุงูู ูุฌููุนูโุง ุงุฒ ุงุจุฒุงุฑูุง ุฑุง ุจู ุตูุฑุช ฺฉ ููุฏ `<select>` ููุงุด ู ุฏูุฏ. ุงุจุฒุงุฑ ฺฉู  ุงูุชุฎุงุจ ุดุฏู ูุดุฎุต ู ฺฉูุฏ ฺฉู ุชุนุงูู ุงุดุงุฑูโฺฏุฑ ุจุง ุชุตูุฑ ฺู ุฎูุงูุฏ ุจูุฏ. ูุฌููุนูโ ุงุจุฒุงุฑโูุง ููุฌูุฏ ุจู ุตูุฑุช ฺฉ ุดุก ูุฑุงูู ูโุดููุฏ ฺฉู ูุงูโูุง ูุดุงู ุฏุงุฏู ุดุฏู ุฏุฑ ููุฏ select ุฑุง ุจู ุชูุงุจุน ฺฉู ุขู ุงุจุฒุงุฑ ุฑุง ูพุงุฏู ุณุงุฒ ู ฺฉููุฏุ ูฺฏุงุดุช ู ฺฉูุฏ. ุงู ุชูุงุจุน ฺฉ ูููุนุช ุชุตูุฑ ุ ฺฉ ูุถุนุช ูุนู ุจุฑูุงูู ู ูุฒ ฺฉ ุชุงุจุน `dispatch` ุฑุง ุจู ุนููุงู ุขุฑฺฏููุงู ู ฺฏุฑูุฏ. ุฎุฑูุฌ ุขูโูุง ููฺฉู ุงุณุช ฺฉ ฺฏุฑุฏุงููุฏูโ ุญุฑฺฉุช ุจุงุดุฏ ฺฉู ุจุง ุชุบุฑ ูฺฉุงู ุงุดุงุฑูโฺฏุฑ ุจู ฺฉ ูพฺฉุณู ุฏฺฏุฑ ู ุฏุฑ ูุชุฌู ุชุบุฑ ูุถุนุช ู ูููุนุช ุฌุฏุฏ ูุฑุงุฎูุงู ู ุดูุฏ.


```{includeCode: true}
class PixelEditor {
  constructor(state, config) {
    let {tools, controls, dispatch} = config;
    this.state = state;

    this.canvas = new PictureCanvas(state.picture, pos => {
      let tool = tools[this.state.tool];
      let onMove = tool(pos, this.state, dispatch);
      if (onMove) return pos => onMove(pos, this.state);
    });
    this.controls = controls.map(
      Control => new Control(state, config));
    this.dom = elt("div", {}, this.canvas.dom, elt("br"),
                   ...this.controls.reduce(
                     (a, c) => a.concat(" ", c.dom), []));
  }
  syncState(state) {
    this.state = state;
    this.canvas.syncState(state.picture);
    for (let ctrl of this.controls) ctrl.syncState(state);
  }
}
```
ฺฏุฑุฏุงููุฏูโ ุงุดุงุฑูโฺฏุฑ ฺฉู ุจู `PictureCanvas` ุฏุงุฏู ู ุดูุฏ ุ ุงุจุฒุงุฑ ฺฉู ุฏุฑ ุญุงู ุญุงุถุฑ ุงูุชุฎุงุจ ุดุฏู ุงุณุช ุฑุง ุจุง ุขุฑฺฏููุงูโูุง ููุงุณุจ ูุฑุงุฎูุงู ู ฺฉูุฏ ู ุงฺฏุฑ ูพุงุณุฎ ุขู ฺฉ ฺฏุฑุฏุงููุฏูโ ุญุฑฺฉุช ุจุงุดุฏุ ุขู ุฑุง ุจู ฺฏูููโุง ุชุบุฑ ู ุฏูุฏ ฺฉู ูุถุนุช ุฑุง ูุฒ ุฏุฑุงูุช ฺฉูุฏ.

{{index "reduce method", "map method", [whitespace, "in HTML"], "syncState method"}}

ุชูุงู ฺฉูุชุฑูโูุง ุฏุฑ `this.controls` ุณุงุฎุชุงุฑ ุงูุชู ู ุฐุฎุฑู ู ุดููุฏ ุฏุฑ ูุชุฌู ู ุชูุงู ุขููุง ุฑุง ุจุง ุชุบุฑ ูุถุนุช ุจุฑูุงูู ุจูโุฑูุฒ ุฑุณุงู ฺฉุฑุฏ. ูุฑุงุฎูุงู `reduce` ุจุงุนุซ ุจู ูุฌูุฏ ุขูุฏู ูุงุตููโูุง ุจู ุนูุงุตุฑ ฺฉูุชุฑู DOM ู ุดูุฏ. ุงู ฺฉุงุฑ ุจุงุนุซ ูโุดูุฏ ุทูุฑ ููุงุด ุฏุงุฏู ูุดููุฏ ฺฉู ุจู ูุธุฑ ุจุฑุณุฏ ููฺฏ ุจุงูู ูุดุฑุฏู ุดุฏู ุงูุฏ.

{{index "select (HTML tag)", "change event", "ToolSelect class", "syncState method"}}

ุงููู ฺฉูุชุฑูุ ููู ุงูุชุฎุงุจ ุงุจุฒุงุฑ ุงุณุช. ุงู ฺฉูุชุฑู ฺฉ ุนูุตุฑ `<select>` ุจุง ฺฉ ฺฏุฒูู ุจุฑุง ูุฑ ุงุจุฒุงุฑ ู ุณุงุฒุฏ ู ฺฉ
ฺฏุฑุฏุงููุฏูโ ุฑุฎุฏุงุฏ ุจุฑุง `"change"` ุชูุธู ู ฺฉูุฏ ฺฉู ูุถุนุช ุจุฑูุงูู ุฑุง ุจุง ุงูุชุฎุงุจ ูุฑ ุงุจุฒุงุฑ ุชุบุฑ ู ุฏูุฏ.


```{includeCode: true}
class ToolSelect {
  constructor(state, {tools, dispatch}) {
    this.select = elt("select", {
      onchange: () => dispatch({tool: this.select.value})
    }, ...Object.keys(tools).map(name => elt("option", {
      selected: name == state.tool
    }, name)));
    this.dom = elt("label", null, "๐ Tool: ", this.select);
  }
  syncState(state) { this.select.value = state.tool; }
}
```

{{index "label (HTML tag)"}}

ุจุง ูุฑุงุฑ ุฏุงุฏู ูุชู ุนููุงู ููุฏ ู ุฎูุฏ ููุฏ ุฏุฑูู ฺฉ ุนูุตุฑ `<label>` ุจู ูุฑูุฑฺฏุฑ ุงุนูุงู ูโฺฉูู ฺฉู ุนููุงู ููุฑุฏ ูุธุฑ ูุฑุจูุท ุจู ุงู ููุฏ ู ุจุงุดุฏ ุฏุฑ ูุชุฌู ู ุชูุงูุฏ ุจู ุนููุงู ูุซุงู ุฑู ุนููุงู ฺฉูฺฉ ฺฉูุฏ ุชุง ููุฏ ูุนุงู ุดูุฏ.

{{index "color field", "input (HTML tag)"}}

ููฺูู ูุงุฒู ุงุณุช ุชุง ุจุชูุงูู ุฑูฺฏ ุฑุง ุชุบุฑ ุฏูู โ ูพุณ ุงุฌุงุฒู ุจุฏูุฏ ุชุง ฺฉ ฺฉูุชุฑู ุจุฑุง ุขู ุฏุฑ ูุธุฑ ุจฺฏุฑู. ฺฉ ุนูุตุฑ `<input>` ฺฉู ุฎุตุตูโ `type` ุขู `color` ุงุณุช ุจู ูุง ููุฏ ูุฑู ุฑุง ู ุฏูุฏ ฺฉู ุจุฑุง ุงูุชุฎุงุจ ุฑูฺฏ ุทุฑุงุญ ุดุฏู ุงุณุช. ููุฏุงุฑ ุงู ููุฏ ููุดู ฺฉ ฺฉุฏ ุฑูฺฏ CSS ุจู ูุฑูุช <bdo>`"#RRGGBB"`</bdo> ู ุจุงุดุฏ (ูุฑูุฒ ุ ุณุจุฒ ู ุขุจ. ุจุฑุง ูุฑ ุฑูฺฏ ุฏู ุฑูู). ูุฑูุฑฺฏุฑ ฺฉ ุฑุงุจุท ุงูุชุฎุงุจฺฏุฑ ุฑูฺฏ ุฑุง ุจู ฺฉุงุฑุจุฑ ูุดุงู ู ุฏูุฏ ุชุง ุจุชูุงูุฏ ุจุง ุขู ฺฉุงุฑ ฺฉูุฏ.

{{if book

ุจุณุชู ุจู ูุฑูุฑฺฏุฑุ ุงูุชุฎุงุจฺฏุฑ ุฑูฺฏ ููฺฉู ุงุณุช ุดุจู ุจู ุชุตูุฑ ุฒุฑ ุจุงุดุฏ:

{{figure {url: "img/color-field.png", alt: "A color field", width: "6cm"}}}

if}}

{{index "ColorSelect class", "syncState method"}}

ุงู ฺฉูุชุฑู ููุฏ ูุฐฺฉูุฑ ุฑุง ุงุฌุงุฏ ู ฺฉูุฏ ู ุทูุฑ ุขู ุฑุง ู ููุณุฏ ฺฉู ุจุง ุฎุงุตุช `color` ูุถุนุช ุจุฑูุงูู ููฺฏุงู ุจูุงูุฏ.

```{includeCode: true}
class ColorSelect {
  constructor(state, {dispatch}) {
    this.input = elt("input", {
      type: "color",
      value: state.color,
      onchange: () => dispatch({color: this.input.value})
    });
    this.dom = elt("label", null, "๐จ Color: ", this.input);
  }
  syncState(state) { this.input.value = state.color; }
}
```

## ุงุจุฒุงุฑ ุชุฑุณู

ูพุด ุงุฒ ุขูฺฉู ุจุชูุงูู ฺุฒ ุฑุณู ฺฉููุ ูุงุฒู ุงุณุช ุชุง ุงุจุฒุงุฑูุง ฺฉู ูุฑุงุฑ ุงุณุช ฺฉุงุฑฺฉุฑุฏ ููุณ ุง ุฑุฎุฏุงุฏูุง ููุณ ุฑู ุจูู ุฑุง ฺฉูุชุฑู ฺฉูุฏ ูพุงุฏู ุณุงุฒ ฺฉูู.

{{index "draw function"}}

ูพุงูโุง ุชุฑู ุงุจุฒุงุฑุ ุงุจุฒุงุฑ ุชุฑุณู ุงุณุช  ฺฉู ูุฑ ูพฺฉุณู ฺฉู ุฑู ุขู ฺฉูฺฉ ู ุดูุฏ ุง ููุณ ู ุดูุฏ ุฑุง ุจู ุฑูฺฏ ุงูุชุฎุงุจ ุดุฏู ุชุบุฑ ู ุฏูุฏ. ุงู ุงุจุฒุงุฑ ุงฺฉุดู ุฑุง ุจุฑุง ุชุบุฑ ุชุตูุฑ ุจู ุชุตูุฑ ฺฉู ุฏุฑ ุขู ูพฺฉุณู ููุฑุฏ ุงุดุงุฑู ุจู ุฑูฺฏ ุงูุชุฎุงุจ ุดุฏู ุชุบุฑ ุงูุชู ุงุณุชุ ฺฏุณู ูโููุงุฏ.

```{includeCode: true}
function draw(pos, state, dispatch) {
  function drawPixel({x, y}, state) {
    let drawn = {x, y, color: state.color};
    dispatch({picture: state.picture.draw([drawn])});
  }
  drawPixel(pos, state);
  return drawPixel;
}
```

ุชุงุจุน ุจูุงูุงุตูู ุชุงุจุน `drawPixel` ุฑุง ูุฑุงุฎูุงู ู ฺฉูุฏ ู ุจุนุฏ ุขู ุฑุง ุจุฑ ู ฺฏุฑุฏุงูุฏ ุฏุฑ ูุชุฌู ุฏูุจุงุฑู ุจุฑุง ูพฺฉุณูโูุง ููุณโุดุฏูโ ุฏฺฏุฑ ุฏุฑ ููฺฏุงู ฺฉู ฺฉุงุฑุจุฑ ููุณ ุง ุงูฺฏุดุชุด ุฑุง ุญุฑฺฉุช ู ุฏูุฏุ ูุฑุงุฎูุงู ู ุดูุฏ.

{{index "rectangle function"}}

ุจุฑุง ุชุฑุณู ุงุดฺฉุงู ุจุฒุฑฺฏุชุฑ ุจูุชุฑ ุงุณุช ุงูฺฉุงู ฺฉุดุฏู ฺูุงุฑโุถูุนโ ูุฑุงูู ุจุงุดุฏ. ุงุจุฒุงุฑ `rectangle` ฺฉ ฺูุงุฑุถูุน ุจู ููุทูโ ุดุฑูุน ุชุฑุณู ู ููุทูโุง ฺฉู ููุณ ูุชููู ู ุดูุฏ ุชุฑุณู ู ฺฉูุฏ.

```{includeCode: true}
function rectangle(start, state, dispatch) {
  function drawRectangle(pos) {
    let xStart = Math.min(start.x, pos.x);
    let yStart = Math.min(start.y, pos.y);
    let xEnd = Math.max(start.x, pos.x);
    let yEnd = Math.max(start.y, pos.y);
    let drawn = [];
    for (let y = yStart; y <= yEnd; y++) {
      for (let x = xStart; x <= xEnd; x++) {
        drawn.push({x, y, color: state.color});
      }
    }
    dispatch({picture: state.picture.draw(drawn)});
  }
  drawRectangle(start);
  return drawRectangle;
}
```

{{index "persistent data structure", [state, persistence]}}

ฺฉ ูฺฉุชูโ ุฌุฒุฆ ุฏุฑ ูพุงุฏู ุณุงุฒ ุงู ุงุจุฒุงุฑ ุงู ุงุณุช ฺฉู ุฏุฑ ููฺฏุงู ฺฉุดุฏู (dragging)ุ ฺูุงุฑุถูุน ุงุฒ ุฑู ูุถุนุช  ุงุตู ุฑู ุชุตูุฑ ุจุงุฒุชุฑุณู ูโุดูุฏ. ุฏุฑ ุงู ุญุงูุชุ ู ุชูุงูุฏ ฺูุงุฑุถูุน ุฑุง ุฏุฑ ููฺฏุงู ุฑุณู ุจุฒุฑฺฏุชุฑ ุง ฺฉูฺฺฉุชุฑ ฺฉูุฏ ุจุฏูู ุงูฺฉู ฺูุงุฑุถูุน ูุง ฺฉู ุงู ูุงู ุฑุณู ู ุดููุฏ ุฑู ุชุตูุฑ ููุง ุจุงู ุจูุงููุฏ. ุงู ฺฉ ุงุฒ ุฏูุงู ุงุณุช ฺฉู ุงุดุงุก ุชุตูุฑ ุบุฑูุงุจู ุชุบุฑ ููุฏ ูุงูุน ู ุดููุฏ โ ุจุนุฏุง ุฏูู ุฏฺฏุฑ ูุฒ ุฎูุงูู ุฏุฏ.

ูพุงุฏู ุณุงุฒ ุฑูฺฏ ุขูุฒ ูุงุญูโูุง ููโุฑูฺฏ ุง ูุชุตู (flood fill) ููุฏุงุฑ ูพฺุฏูโุชุฑ ุงุณุช. ุงู ุงุจุฒุงุฑ ูพฺฉุณู ููุฑุฏ ุงุดุงุฑู ู ูููโ ูพฺฉุณูโูุง ููุฌูุงุฑุด ฺฉู ุฑูฺฏ ูุดุงุจู ุฏุงุฑูุฏ ุฑุง ุฑูฺฏ ู ฺฉูุฏ. ููุฌูุงุฑ ุจู ุงู ูุนูุงุณุช ฺฉู ุจู ุตูุฑุช ุงูู ุง ุนููุฏ ููุฌูุงุฑ ุจุงุดุฏ ูู ุจู ุตูุฑุช ูุทุฑ. ุงู ุชุตูุฑ ูุฌููุนูโ ูพฺฉุณูโูุง ุฑูฺฏ ุดุฏู ุฏุฑ ุฒูุงู ุงุณุชูุงุฏู ุงุฒ ุงู ุงุจุฒุงุฑ ูุดุฎุต ุฑุง ูุดุงู ู ุฏูุฏ:

{{figure {url: "img/flood-grid.svg", alt: "A pixel grid showing the area filled by a flood fill operation", width: "6cm"}}}

{{index "fill function"}}

ุจู ุดฺฉู ุฌุงูุจุ ุฑูุด ฺฉู ูุง ุจุฑุง ุงูุฌุงู ุงู ฺฉุงุฑ ุงุณุชูุงุฏู ู ฺฉูู ุดุจู ุจู ฺฉุฏ ุงุณุช ฺฉู ุจุฑุง ูุณุฑุงุจ ุฏุฑ [ูุตู ?](robot) ููุดุชู. ุฏุฑ ุญุงู ฺฉู ุขู ฺฉุฏ ุจู ุฌุณุชุฌู ุฏุฑ ุทูู ฺฉ ฺฏุฑุงู ุจุฑุง ุงูุชู ฺฉ ูุณุฑ ู ูพุฑุฏุงุฎุชุ ุงู ฺฉุฏ ุจู ุฌุณุชุฌู ุฏุฑ ฺฉ ฺฏุฑุฏ ุจุฑุง ูพุฏุง ฺฉุฑุฏู ูพฺฉุณูโูุง ูุชุตู ู ูพุฑุฏุงุฒุฏ. ูุดฺฉู ูฺฏูุฏุงุฑ ู ุฑุตุฏ ฺฉ ูุฌููุนู ุดุงุฎู ุงุฒ ูุณุฑูุง ููฺฉูุ ุดุจู ุจู ุขู ูุณุงูู ุงุณุช.

```{includeCode: true}
const around = [{dx: -1, dy: 0}, {dx: 1, dy: 0},
                {dx: 0, dy: -1}, {dx: 0, dy: 1}];

function fill({x, y}, state, dispatch) {
  let targetColor = state.picture.pixel(x, y);
  let drawn = [{x, y, color: state.color}];
  for (let done = 0; done < drawn.length; done++) {
    for (let {dx, dy} of around) {
      let x = drawn[done].x + dx, y = drawn[done].y + dy;
      if (x >= 0 && x < state.picture.width &&
          y >= 0 && y < state.picture.height &&
          state.picture.pixel(x, y) == targetColor &&
          !drawn.some(p => p.x == x && p.y == y)) {
        drawn.push({x, y, color: state.color});
      }
    }
  }
  dispatch({picture: state.picture.draw(drawn)});
}
```
ุขุฑุงูโ ูพฺฉุณูโูุง ุฑุณู ุดุฏู ุ ุจู ุนููุงู ูุณุช ฺฉุงุฑ ุงู ุชุงุจุน ุงุณุชูุงุฏู ูโุดูุฏ. ุจุฑุง ูุฑ ูพฺฉุณู ฺฉู ุจุฑุฑุณ ู ุดูุฏุ ุจุงุณุช ุจุจูู ฺฉู ุขุง ูพฺฉุณูโูุง ููุฌูุงุฑุด ุฑูฺฏ ูุดุงุจู ุฏุงุฑูุฏ ุง ุฎุฑ ู ุขุง ูุจู ุงุฒ ุงู ุฑูฺฏโุขูุฒ ุดุฏู ุงูุฏ. ุจุง ูุฑูุฏ ูพฺฉุณูโูุง ุฌุฏุฏุ ุดูุงุฑูุฏูโ ุญููู ุงุฒ ุทูู ุขุฑุงูโ `drawn` ุนูุจ ูโุงูุชุฏ. ุชูุงู ูพฺฉุณูโูุง ุฌููุชุฑ ุงุฒ ุขู ููฺูุงู ูุงุฒู ุงุณุช ุชุง ุจุฑุฑุณ ุดููุฏ. ุฒูุงู ฺฉู ุดูุงุฑูุฏู ุจู ุทูู ุขุฑุงู ู ุฑุณุฏ ุ ูฺ ูพฺฉุณู ุจุฑุฑุณ ูุดุฏูโุง ูู ูุงูุฏ ู ฺฉุงุฑ ุชุงุจุน ุชูุงู ู ุดูุฏ.

{{index "pick function"}}

ุขุฎุฑู ุงุจุฒุงุฑุ ฺฏุฒูุดฺฏุฑ ุฑูฺฏ ู ุจุงุดุฏ ฺฉู ุจู ุดูุง ุงูฺฉุงู ุงูุชุฎุงุจ ฺฉ ุฑูฺฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุงุดุงุฑู ฺฏุฑ ู ุงุณุชูุงุฏู ุงุฒ ุขู ุจู ุนููุงู ุฑูฺฏ ูุนู ุชุฑุณู ุฑุง ู ุฏูุฏ.

```{includeCode: true}
function pick(pos, state, dispatch) {
  dispatch({color: state.picture.pixel(pos.x, pos.y)});
}
```

{{if interactive

ุงฺฉููู ู ุชูุงูู ุงูพูฺฉุดูโูุงู ุฑุง ุขุฒูุงุด ููุงู!

```{lang: "text/html"}
<div></div>
<script>
  let state = {
    tool: "draw",
    color: "#000000",
    picture: Picture.empty(60, 30, "#f0f0f0")
  };
  let app = new PixelEditor(state, {
    tools: {draw, fill, rectangle, pick},
    controls: [ToolSelect, ColorSelect],
    dispatch(action) {
      state = updateState(state, action);
      app.syncState(state);
    }
  });
  document.querySelector("div").appendChild(app.dom);
</script>
```

if}}

## ุฐุฎุฑู ุณุงุฒ ู ุจุงุฑฺฏุฑ

{{index "SaveButton class", "drawPicture function", [file, image]}}

ูพุณ ุงุฒ ุงุชูุงู ุชุฑุณู ุดุงูฺฉุงุฑ ููุฑโูุงูุ ู ุฎูุงูู ุขู ุฑุง ุฐุฎุฑู ฺฉูู. ุจุงุณุช ุฏฺฉููโุง ุงุถุงูู ฺฉูู ฺฉู ุจุชูุงู ุจู ูุณููโ ุขู ุชุตูุฑ ูุนู ุฑุง ุจู ุดฺฉู ฺฉ ูุงู ุนฺฉุณ ุจุงุฑฺฏุฑ ฺฉุฑุฏ. ุงู ฺฉูุชุฑู ุฏฺฉููโ ูุฐฺฉูุฑ ุฑุง ุงุฌุงุฏ ู ฺฉูุฏ.

```{includeCode: true}
class SaveButton {
  constructor(state) {
    this.picture = state.picture;
    this.dom = elt("button", {
      onclick: () => this.save()
    }, "๐พ Save");
  }
  save() {
    let canvas = elt("canvas");
    drawPicture(this.picture, canvas, 1);
    let link = elt("a", {
      href: canvas.toDataURL(),
      download: "pixelart.png"
    });
    document.body.appendChild(link);
    link.click();
    link.remove();
  }
  syncState(state) { this.picture = state.picture; }
}
```

{{index "canvas (HTML tag)"}}


ุงู ูุคููู ุชุตูุฑ ูุนู ุฑุง ุฑุตุฏ ฺฉุฑุฏู ุฏุฑ ูุชุฌู ู ุชูุงูุฏ ุขู ุฑุง ุฐุฎุฑู ฺฉูุฏ. ุจุฑุง  ุณุงุฎุช ฺฉ ูุงู ุชุตูุฑ ุ ุงุฒ ุนูุตุฑ `<canvas>` ฺฉู ุชุตูุฑ ุฑุง ุฑู ุขู ุฑุณู ู ฺฉูู (ุฏุฑ ููุงุณ ฺฉ ูพฺฉุณู ุจุฑ ูพฺฉุณู) ุงุณุชูุงุฏู ู ฺฉูู.

{{index "toDataURL method", "data URL"}}

ูุชุฏ `toDataURL` ุฑู ฺฉ canvas ฺฉ URL ุงุฌุงุฏ ู ฺฉูุฏ ฺฉู ุจุง <bdo>`data:`</bdo> ุดุฑูุน ู ุดูุฏ. ุจุฑุฎูุงู URLูุง <bdo>`http:`</bdo> ู <bdo>`https:`</bdo> ุขุฏุฑุณ  (URL)ูุง ุงุฒ ููุน data ุญุงู ุชูุงู ููุจุน ุฏุฑ ุฎูุฏ URL ู ุจุงุดูุฏ. ุงู URL ูุง ูุนูููุง ุฎู ุจููุฏ ูุณุชูุฏ ุงูุง ุจู ูุง ุงู ุงูฺฉุงู ุฑุง ู ุฏููุฏ ุชุง ูพููุฏูุง ูุงูุน ุจู ุชุตุงูุฑ ุฏูุฎูุงู ุจุณุงุฒูุ ุฏุฑ ุฏู ุฎูุฏ ูุฑูุฑฺฏุฑ.

{{index "a (HTML tag)", "download attribute"}}

ุจุฑุง ุงูฺฉู ฺฉุงุฑ ฺฉูู ุชุง ูุฑูุฑฺฏุฑ ุชุตูุฑ ุงุฌุงุฏ ุดุฏู ุฑุง ุฏุงูููุฏ ฺฉูุฏุ ฺฉ ุนูุตุฑ ููฺฉ ู ุณุงุฒู ฺฉู ุจู ุงู URL ุงุดุงุฑู ู ฺฉูุฏ ู ุฏุงุฑุง ฺฉ ุฎุตุตูโ `download` ูโุจุงุดุฏ. ุงู ฺฏููู ููฺฉโูุงุ ุฏุฑ ุฒูุงู ฺฉูฺฉ ุดุฏูุ ุจุงุนุซ ู ุดููุฏ ฺฉู ูุฑูุฑฺฏุฑ ฺฉ ูพูุฌุฑูโ ูุญุงูุฑูโุง ุฐุฎุฑู ูุงู ุฑุง ููุงุด ุฏููุฏ. ูุง ุขู ููฺฉ ุฑุง ุจู ุณูุฏ ุงุถุงูู ู ฺฉูู ู ุนูู ฺฉูฺฉ ฺฉุฑุฏู ุฑุง ุฑู ุขู ุดุจูโุณุงุฒ ู ฺฉูู ู ุณูพุณ ุขู ุฑุง ุญุฐู ู ฺฉูู.

ฺฉุงุฑูุง ุฒุงุฏ ุจุง ุชฺฉููููฺ ูุฑูุฑฺฏุฑ ูุง ู ุชูุงู ุงูุฌุงู ุฏุงุฏ ุงูุง ฺฏุงู ุงููุงุช ุจุฑุง ุงูุฌุงู ฺฉุงุฑ ูุงุฒู ุงุณุช ฺฉู ุงุฒ ุฑูุดโูุง ูุงูุงููุณ ุงุณุชูุงุฏู ฺฉูู.

{{index "LoadButton class", control, [file, image]}}

ู ุจุฏุชุฑ ูู ูโุดูุฏ. ูุงุฒู ุงุณุช ุจุชูุงูู ฺฉ ูุงู ุชุตูุฑ ุฑุง ูุฒ ุจู ุฏุฑูู ุจุฑูุงูู ุจุงุฑฺฏุฑ ฺฉูู. ุจุฑุง ุงู ฺฉุงุฑุ ุฏูุจุงุฑู ฺฉ ูุคููู ุฏฺฉูู ู ุณุงุฒู.

```{includeCode: true}
class LoadButton {
  constructor(_, {dispatch}) {
    this.dom = elt("button", {
      onclick: () => startLoad(dispatch)
    }, "๐ Load");
  }
  syncState() {}
}

function startLoad(dispatch) {
  let input = elt("input", {
    type: "file",
    onchange: () => finishLoad(input.files[0], dispatch)
  });
  document.body.appendChild(input);
  input.click();
  input.remove();
}
```

{{index [file, access], "input (HTML tag)"}}

ุจุฑุง ุฏุณุชุฑุณ ุจู ฺฉ ูุงู ุฑู ฺฉุงููพูุชุฑ ฺฉุงุฑุจุฑุ ฺฉุงุฑุจุฑ ุจุงุณุช ฺฉ ูุงู ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ ููุฏ ูุฑูุฏ ูุงู ุงูุชุฎุงุจ ฺฉูุฏ. ุงูุง ูู ูู ุฎูุงูู ฺฉู ุฏฺฉููโ ุจุงุฑฺฏุฑ ุดุจู ุจู ููุฏ ูุฑูุฏ ูุงู ุจุงุดุฏุ ุจูุงุจุฑุงู ุจุนุฏ ุงุฒ ูุดุฑุฏู ุฏฺฉููุ ููุฏ ูุงู ุฑุง ุงุฌุงุฏ ู ฺฉูู ู ุณูพุณ ูุงูููุฏ ู ฺฉูู ฺฉู ุฎูุฏุด ฺฉูฺฉ ุฑุง ุงูุฌุงู ุฏุงุฏู ุงุณุช.

{{index "FileReader class", "img (HTML tag)", "readAsDataURL method", "Picture class"}}

ุฒูุงู ฺฉู ฺฉุงุฑุจุฑ ฺฉ ูุงู ุฑุง ุงูุชุฎุงุจ ู ฺฉูุฏุ ู ุชูุงูู ุงุฒ `FileReader` ุจุฑุง ุฏุณุชุฑุณ ุจู ูุญุชูุง ุขู ุงุณุชูุงุฏู ฺฉูู ู ุฏูุจุงุฑู ุจู ุนููุงู ฺฉ data URL. ุงู URL ุฑุง ู ุชูุงู ุจุฑุง ุงุฌุงุฏ ฺฉ ุนูุตุฑ `<img>` ุงุณุชูุงุฏู ฺฉุฑุฏ ุงูุง ุจู ุฏูู ุงูฺฉู ุฏุณุชุฑุณ ูุณุชูู ุจู ูพฺฉุณูโูุง ุงู ุชุตูุฑ ูุฏุงุฑูุ ูู ุชูุงูู ฺฉ ุดุก `Picture` ุงุฒ ุขู ุจุณุงุฒู.


```{includeCode: true}
function finishLoad(file, dispatch) {
  if (file == null) return;
  let reader = new FileReader();
  reader.addEventListener("load", () => {
    let image = elt("img", {
      onload: () => dispatch({
        picture: pictureFromImage(image)
      }),
      src: reader.result
    });
  });
  reader.readAsDataURL(file);
}
```

{{index "canvas (HTML tag)", "getImageData method", "pictureFromImage function"}}

ุจุฑุง ุฏุณุชุฑุณ ุจู ูพฺฉุณูโูุง ุจุงุณุช ุงุจุชุฏุง ฺฉ ุชุตูุฑ ุฑู ุนูุตุฑ `<canvas>` ุฑุณู ฺฉูู. context ุงู canvas ูุชุฏ ุจู ูุงู `getImageData` ุฏุงุฑุฏ ฺฉู ุจู ุฌุงูุงุงุณฺฉุฑูพุช ุงู ุงูฺฉุงู ุฑุง ู ุฏูุฏ ุชุง ูพฺฉุณู ูุง ุขู ุฑุง ุจุฎูุงูุฏ. ุจูุงุจุฑุงู ุจุง ูุฑุงุฑ ฺฏุฑูุชู ุชุตูุฑ ุฑู ุจููุ ู ุชูุงูู ุจู ุขู ุฏุณุชุฑุณ ุฏุงุดุชู ุจุงุดุฏ ู ุด `Picture` ุฑุง ุจุณุงุฒู.


```{includeCode: true}
function pictureFromImage(image) {
  let width = Math.min(100, image.width);
  let height = Math.min(100, image.height);
  let canvas = elt("canvas", {width, height});
  let cx = canvas.getContext("2d");
  cx.drawImage(image, 0, 0);
  let pixels = [];
  let {data} = cx.getImageData(0, 0, width, height);

  function hex(n) {
    return n.toString(16).padStart(2, "0");
  }
  for (let i = 0; i < data.length; i += 4) {
    let [r, g, b] = data.slice(i, i + 3);
    pixels.push("#" + hex(r) + hex(g) + hex(b));
  }
  return new Picture(width, height, pixels);
}
```

ูุง ุงูุฏุงุฒูโ ุชุตุงูุฑ ุฑุง ุจู 100 ุฏุฑ 100 ูพฺฉุณู ูุญุฏูุฏ ุฎูุงูู ฺฉุฑุฏ ุจู ุงู ุฏูู ฺฉู ูุฑ ุชุตูุฑ ุจุฒุฑฺฏุชุฑ ุฑู ุตูุญูโููุงุด ูุง ุฎู ุจุฒุฑฺฏ ุจู ูุธุฑ ู ุฑุณุฏ ู ููฺฉู ุงุณุช ุจุงุนุซ ฺฉูุฏ ุฑุงุจุท ฺฉุงุฑุจุฑ ุดูุฏ.


{{index "getImageData method", color, transparency}}

ุฎุงุตุช `data` ูุฑุจูุท ุจู ุดุกุง ฺฉู ุจุง `getImageData` ุจุฑู ฺฏุฑุฏุฏุ ุขุฑุงูโุง ุงุฒ ูุคูููโูุง ุฑูฺฏ ู ุจุงุดุฏ. ุจุฑุง ูุฑ ูพฺฉุณู ูุชุนูู ุจู ฺูุงุฑุถูุนุ ฺฉู ุชูุณุท ุขุฑฺฏููุงูโูุง ูุดุฎุต ุดุฏู ุงุณุชุ ุฏุงุฑุง ฺูุงุฑ ููุฏุงุฑ ูโุจุงุฏ ฺฉู ููุงุงูฺฏุฑ ุงุฌุฒุง ูุฑูุฒุ ุณุจุฒุ ุขุจ ู ุขููุง ุฑูฺฏ ูพฺฉุณู ูโุจุงุดูุฏ ฺฉู ุงุนุฏุงุฏ ุจู 0 ู 255 ูุณุชูุฏ. ุจุฎุด alpha ูุฑุจูุท ุจู ุดูุงูุช ู ุจุงุดุฏ โ ุฒูุงู ฺฉู ุจุฑุงุจุฑ ุตูุฑ ุงุณุชุ ูพฺฉุณู ฺฉุงููุง ุดูุงู ู ุจุงุดุฏ ู ููุช 255 ุงุณุช ฺฉุงูู ูุงุช ู ุดูุฏ. ุจุฑุง ููุตูุฏ ูุงุ ู ุชูุงูู ุงุฒ ุขู ุตุฑู ูุธุฑ ฺฉูู.


{{index "hexadecimal number", "toString method"}}

ุฏู ุนุฏุฏ ูฺฏุฒุงุฏุณูุงู ุจุฑุง ูุฑ ูุคููู ฺฉู ุฏุฑ ููุฏุงุฑ ุฑูฺฏ ูุง ุขูุฏู ุงุณุชุ ุจู ุดฺฉู ุฏูู ูุชูุงุธุฑ ุจุง ุทู 0 ุชุง 255 ุงุณุช โ ุฏู ุฑูู ูุจูุง 16 ู ุชูุงููุฏ  <bdo>16^2^ = 256</bdo> ุนุฏุฏ ูุชูุงูุช ุฑุง ููุงุด ุฏููุฏ. ุจู ูุชุฏ `toString` ูุฑุจูุท ุจู ุงุนุฏุงุฏ ู ุชูุงู ฺฉ ูุจูุง ุจู ุนููุงู ุขุฑฺฏููุงู ูุฑุณุชุงุฏุ ุจูุงุจุฑุงู  <bdo>`n.toString(16)`</bdo> ุฑุดุชูโุง ุชููุฏ ู ฺฉูุฏ ฺฉู ุฏุฑ ูุจูุง 16 ูุดุงู ุฏุงุฏู ู ุดูุฏ. ุจุงุณุช ูุทูุฆู ุดูู ฺฉู ูุฑ ุนุฏุฏ ุฏู ุฑูู ุงุดุบุงู ู ฺฉูุฏ ุฏุฑ ูุชุฌู ุชุงุจุน ฺฉูฺฉ `hex` ุชุงุจุน `padStart` ุฑุง ุจุฑุง ุงูุฒูุฏู ุตูุฑูุง ูพุดู ุฏุฑ ุตูุฑุช ูุงุฒ ูุฑุงุฎูุงู ุฎูุงูุฏ ุดุฏ.

ุงฺฉููู ู ุชูุงูู ุจุงุฑฺฏุฑ ู ุฐุฎุฑู ฺฉูู. ฺฉ ุงูฺฉุงู ุฏฺฏุฑ ู ูุงูุฏ ุชุง ฺฉุงุฑ ุชูุงู ุดูุฏ.


## ุจุงุฒฺฏุดุช ุฏุฑ ุชุงุฑุฎฺู (undo)

ูู ุงุฒ ุฑููุฏ ุนูู ูุฑุงุด ุดุงูู ุงูุฌุงู ุงุดุชุจุงูุงุช ฺฉูฺฺฉ ู ุจุฑุทุฑู ฺฉุฑุฏู ุขูโูุง ุงุณุช. ุจูุงุจุฑุงู ฺฉ ูฺฺฏ ู ฺฉุงุฑฺฉุฑุฏ ููู ุฏุฑ ฺฉ ุจุฑูุงููโ ุชุฑุณู ุงู ุงุณุช ฺฉู ุจุชูุงู ุฏุฑ ุชุงุฑุฎฺู ุจู ุนูุจ ุจุงุฒฺฏุดุช.

{{index "persistent data structure", [state, "of application"]}}

ุจุฑุง ุงูฺฉู ุจุชูุงูู ุชุบุฑุงุช ุฑุง ุฎูุซ ฺฉููุ ูุงุฒู ุงุณุช ุชุง ูุณุฎูโ ูุจู ุงุฒ ุชุตูุฑ ุฑุง ุฌุง ุฐุฎุฑู ฺฉูู. ุจู ุฏูู ุงูฺฉู ุงู ููุฏุงุฑ ุบุฑูุงุจู ุชุบุฑ ู ุจุงุดุฏ ุงู ฺฉุงุฑ ุขุณุงู ุงุณุช. ุงูุง ุงู ฺฉุงุฑ ูุณุชูุฒู ุขู ุงุณุช ฺฉู ููุฏ ุฏฺฏุฑ ุฏุฑ ูุถุนุช ุจุฑูุงูู ุชุนุจู ุดูุฏ.

{{index "done property"}}

ูุง ุขุฑุงูโุง ุจู ูุงู `done` ุงุถุงูู ุฎูุงูู ฺฉุฑุฏ ุชุง ูุณุฎูโูุง ูุจู ุชุตูุฑ ุฑุง ูฺฏูุฏุงุฑ ฺฉูู. ูฺฏูุฏุงุฑ ุงู ุฎุงุตุช ูุงุฒููุฏ ุชุงุจุน ุจูโุฑูุฒ ุฑุณุงู ูุถุนุช ูพฺุฏูโุชุฑ ู ุจุงุดุฏ ฺฉู ุชุตุงูุฑ ุฑุง ุจู ุขุฑุงู ุงุถุงูู ฺฉูุฏ.

{{index "doneAt property", "historyUpdateState function", "Date.now function"}}

ุงูุง ูุง ูุตุฏ ูุฏุงุฑู ูุฑ ุชุบุฑ ุฑุง ุฐุฎุฑู ฺฉูู. ููุท ุชุบุฑุงุช ฺฉู ุฏุฑ ุจุงุฒูโ ุฒูุงู ุฎุงุต ุฑุฎ ุฏุงุฏู ุจุงุดูุฏ. ุจุฑุง ุงูุฌุงู ุงู ฺฉุงุฑุ ูุงุฒ ุจู ุฎุงุตุช ุฏูู ูุณุชุ `doneAtุ` ฺฉู ุฒูุงู ุขุฎุฑู ุฐุฎุฑูโ ฺฉ ุชุตูุฑ ุฏุฑ ุชุงุฑุฎฺู ุฑุง ูฺฏูุฏุงุฑ ู ฺฉูุฏ.

```{includeCode: true}
function historyUpdateState(state, action) {
  if (action.undo == true) {
    if (state.done.length == 0) return state;
    return Object.assign({}, state, {
      picture: state.done[0],
      done: state.done.slice(1),
      doneAt: 0
    });
  } else if (action.picture &&
             state.doneAt < Date.now() - 1000) {
    return Object.assign({}, state, action, {
      done: [state.picture, ...state.done],
      doneAt: Date.now()
    });
  } else {
    return Object.assign({}, state, action);
  }
}
```

{{index "undo history"}}

ุฒูุงู ฺฉู ุงฺฉุดู ูุงุงุฒ ุฌูุณ ุฎูุซ ฺฉุฑุฏู ุชุบุฑ ุจุงุดุฏุ ุชุงุจุนุ ุขุฎุฑู ุชุตูุฑ ููุฌูุฏ ุฏุฑ ุชุงุฑุฎฺู ุฑุง ุจุฑุฏุงุดุชู ู ุขู ุฑุง ุจู ุนููุงู ุชุตูุฑ ูุนู ูุฑุงุฑ ู ุฏูุฏ. ููฺูู ููุฏุงุฑ `doneAt` ุฑุง ุจุฑุงุจุฑ ุตูุฑ ูุฑุงุฑ ูโุฏูุฏ ุชุง ุชุบุฑ ุจุนุฏ ุฏุฑ ุชุงุฑุฎฺู ุซุจุช ุดูุฏ ู  ุงูฺฉุงู ุนูุจโฺฏุฑุฏ ุจุฑุง ุขู ุฏุฑ ุตูุฑุช ูุงุฒ ูุฑุงูู ุจุงุดุฏ.


ุฏุฑ ุบุฑ ุงู ุตูุฑุชุ ุงฺฏุฑ ุงฺฉุดู ุญุงู ุชุตูุฑ ุฌุฏุฏ ุจุงุดุฏ ู ุขุฎุฑู ุจุงุฑ ฺฉู ูุง ุชุตูุฑ ุฑุง ุฐุฎุฑู ฺฉุฑุฏู ุงู ุจุด ุงุฒ ฺฉ ุซุงูู ุนูุจ ุชุฑ ุจุงุดุฏ ( 1000 ูู ุซุงูู) ุฎุงุตุชโูุง `done` ู `doneAt` ุจูโุฑูุฒ ู ุดููุฏ ุชุง ุชุตูุฑ ูุจู ุฑุง ุฐุฎุฑู ู ฺฉููุฏ.

{{index "UndoButton class", control}}

ูุคูููโ ุฏฺฉููโ ุฎูุซ (undo) ฺฉุงุฑ ุฒุงุฏ ุงูุฌุงู ูู ุฏูุฏ. ุงฺฉุดูโูุง ุฎูุซ ุณุงุฒ ุฑุง ุจุง ุจุฑูุฒ ฺฉูฺฉ ฺฏุณู ู ุฏูุฏ ู  ุฒูุงู ฺฉู ฺุฒ ุจุฑุง ุจุงุฒฺฏุดุช ุง ุฎูุซ ุณุงุฒ ููุฌูุฏ ูุณุชุ ุฎูุฏุด ุฑุง ุบุฑูุนุงู ู ฺฉูุฏ.


```{includeCode: true}
class UndoButton {
  constructor(state, {dispatch}) {
    this.dom = elt("button", {
      onclick: () => dispatch({undo: true}),
      disabled: state.done.length == 0
    }, "โฎช Undo");
  }
  syncState(state) {
    this.dom.disabled = state.done.length == 0;
  }
}
```

## ุงฺฉููู ุฒูุงู ุชุฑุณู ุงุณุช

{{index "PixelEditor class", "startState constant", "baseTools constant", "baseControls constant", "startPixelEditor function"}}

ุจุฑุง ุจุงูุง ุขูุฑุฏู ุจุฑูุงููุ ูุงุฒ ุงุณุช ุชุง ฺฉ ูุถุนุชุ ูุฌููุนูโุง ุงุฒ ุงุจุฒุงุฑุ ูุฌููุนูโุง ุงุฒ ฺฉูุชุฑูโูุง ู ฺฉ ุชุงุจุน ฺฏุณู (dispatch) ุฑุง ุงุฌุงุฏ ฺฉูู. ู ุชูุงูู ุขู ูุง ุฑุง ุจู ุณุงุฒูุฏูโ `PixelEditor` ุงุฑุณุงู ููุงู ุชุง ูุคูููโ ุงุตู ุฑุง ุงุฌุงุฏ ููุงุฏ. ุจู ุฏูู ุงูฺฉู ูุงุฒ ุงุณุช ุชุง ฺูุฏู ูุฑุงุดฺฏุฑ ุฏุฑ ุจุฎุด ุชูุฑูโูุง ุจุณุงุฒูุ ุฏุฑ ุงูุฌุง ฺูุฏ ูุชุบุฑ ุชุนุฑู ู ฺฉูู.


```{includeCode: true}
const startState = {
  tool: "draw",
  color: "#000000",
  picture: Picture.empty(60, 30, "#f0f0f0"),
  done: [],
  doneAt: 0
};

const baseTools = {draw, fill, rectangle, pick};

const baseControls = [
  ToolSelect, ColorSelect, SaveButton, LoadButton, UndoButton
];

function startPixelEditor({state = startState,
                           tools = baseTools,
                           controls = baseControls}) {
  let app = new PixelEditor(state, {
    tools,
    controls,
    dispatch(action) {
      state = historyUpdateState(state, action);
      app.syncState(state);
    }
  });
  return app.dom;
}
```

{{index "destructuring binding", "= operator", [property, access]}}

ุฒูุงู ฺฉู ฺฉ ุดุก ุง ฺฉ ุขุฑุงู ุฑุง destruct ู ฺฉููุ ู ุชูุงูู ุงุฒ = ุจุนุฏ ุงุฒ ูุงู ูุชุบุฑ ุจุฑุง ุชุนู ฺฉ ููุฏุงุฑ
ูพุดูุฑุถ ุจุฑุง ูุชุบุฑ ุงุณุชูุงุฏู ฺฉูู ฺฉู ุฏุฑ ุฒูุงู ฺฉู ุฎุงุตุช ููุฌูุฏ ูุณุช ุง ุจุฑุงุจุฑ `undefined` ู ุจุงุดุฏ ุงุณุชูุงุฏู ู ุดูุฏ. ุชุงุจุน `startPixelEditor` ุงุฒ ุงู ุฎุงุตุช ุงุณุชูุงุฏู ู ฺฉูุฏ ุชุง ุดุกุง ุฑุง ุจุง ุชุนุฏุงุฏ ุฎุงุตุช ุงุฎุชุงุฑ ุจู ุนููุงู ุขุฑฺฏููุงู ูุจูู ู ฺฉูุฏ. ุงฺฏุฑ ุฎุงุตุช `tools` ุฑุง ูุฑุงูู ูุณุงุฒุฏ ุจู ุนููุงู ูุซุงู `tools` ุจู `baseTools` ูุชูุงุธุฑ
ุฎูุงูุฏ ุดุฏ.

ู ุงู ุฑูุด ุงุณุช ฺฉู ูุง ุจู ูุณููโ ุขูุ ฺฉ ูุฑุงุดฺฏุฑ ูุงูุน ุฑุง ุฑู ุตูุญูโ ููุงุด ุงุฌุฑุง ู ฺฉูู

```{lang: "text/html", startCode: true}
<div></div>
<script>
  document.querySelector("div")
    .appendChild(startPixelEditor({}));
</script>
```

{{if interactive

ู ุชูุงูุฏ ฺฉู ุจู ุชุฑุณู ุจูพุฑุฏุงุฒุฏ. ูู ููุชุธุฑ ูโูุงูู.

if}}

## ฺุฑุง ุงู ฺฉุงุฑ ุงู ูุฏุฑ ูพุฑุฒุญูุช ุงุณุช

ุชฺฉููููฺ ูุฑูุฑฺฏุฑูุง ุดฺฏูุชโุงูฺฏุฒ ุงุณุช.ุงู ุชฺฉููููฺ ูุฌููุนูโุง ูุฏุฑุชููุฏ ุงุฒ ุจูุงฺฉโูุง ุจุฑุง ุณุงุฎุช ุฑุงุจุทุ ุฑูุดโูุง ุณุจฺฉโุฏู ู ุชุบุฑ ุณุจฺฉุ ู ุงุจุฒุงุฑูุง ุจุฑุง ุงุดฺฉุงูโุฒุฏุง ู ุจุฑุฑุณ ุจุฑูุงููโูุงุชุงู ุฑุง ูุฑุงูู ูโุณุงุฒุฏ. ูุฑูโุงูุฒุงุฑ ฺฉู ุจุฑุง ูุฑูุฑฺฏุฑ ู ููุณุฏ ุชูุฑุจุง ุฑู ูุฑ ฺฉุงููพูุชุฑ ุง ฺฏูุด ุง ุชุจูุช ุงุฌุฑุง ู ุดูุฏ.


ุฏุฑ ุนู ุญุงูุ ุชฺฉููููฺ ูุฑูุฑฺฏุฑ ูุฒุฎุฑู ุงุณุช. ุดูุง ุจุงุฏ ูุฌููุนูโุง ุจุฒุฑฺฏ ุงุฒ ุชุฑููุฏูุง ุงุญููุงูู ู ุงุทูุงุนุงุช ูุจูู ุฑุง ุงุฏ ุจฺฏุฑุฏ ุชุง ุจู ุขู ูุณูุท ุดูุฏ ู ููฺูู ูุฏู ุจุฑูุงููโููุณ ูพุดโูุฑุถ ฺฉู ูุฑุงูู ู ุณุงุฒุฏ ุจุณุงุฑ ูุดฺฉูโุฒุง ุงุณุช ฺฉู ุจุดุชุฑ ุจุฑูุงูู ููุณุงู ุชุฑุฌุญ ู ุฏููุฏ ุชุง ุขู ุฑุง ุจุง ูุงูโูุง ูุชุนุฏุฏ ุงุฒ ุชุฌุฑุฏ ุจูพูุดุงููุฏ ุชุง ุงู ฺฉู ูุณุชููุง ุจุง ุขู ฺฉุงุฑ ฺฉููุฏ.

{{index standard, evolution}}

ุงฺฏุฑฺู ุงู ุดุฑุงุท ูุทุนุง ุฏุฑ ุญุงู ุจูุจูุฏ ู ุจุงุดุฏุ ุงูุง ุจุดุชุฑ ุงู ุชุบุฑุงุช ุฏุฑ ูุงูุจ ูุนุฑู ุนูุงุตุฑ ุฌุฏุฏ ุจุฑุง ูพูุดุด ฺฉูุจูุฏูุง ุงูุฌุงู ู ุดูุฏ ฺฉู ุฎูุฏ ุจู ูพฺุฏฺฏ ุขู ุงูุฒูุฏู ุงุณุช. ฺฉ ูฺฺฏ ฺฉู ุชูุณุท ููููโูุง ูุจุณุงุช ุงุณุชูุงุฏู ู ุดูุฏ ุฑุง ูู ุชูุงู ุฌุงฺฏุฒู ฺฉุฑุฏ. ู ุญุช ุงฺฏุฑ ุงู ฺฉุงุฑ ุดุฏู ุจุงุดุฏุ ุงูฺฉู ุจุง ฺู ุฌุงฺฏุฒู ุดูุฏ ุฎูุฏ ุชุตูู ุณุฎุช ุงุณุช.

{{index "social factors", "economic factors", history}}

ุชฺฉููููฺ ูฺ ููุช ุฏุฑ ุฎูุงุก ูุงุจู ุจุฑุฑุณ ูุณุช โ ูุง ุชูุณุท ุงุจุฒุงุฑูุงูุงู ู ุฌุงูุนูุุงูุชุตุงุฏ ู ูุงฺฉุชูุฑูุง ุชุงุฑุฎ ฺฉู ุขู ูุง ุฑุง ุงุฌุงุฏ ฺฉุฑุฏู ุงุณุช ูุญุฏูุฏ ู ุดูู. ููฺฉู ุงุณุช ุงู ูุงูุนุช ุขุฒุงุฑุฏููุฏู ุจุงุดุฏุ ุงูุง ุจู ุทูู ฺฉู ูพุฑุจุงุฑุชุฑ ุฎูุงูุฏ ุจูุฏ ุงฺฏุฑ ุชูุงุด ฺฉูู ุชุง ููู ุฎูุจ ุงุฒ ูุญููโ ฺฉุงุฑฺฉุฑุฏ ูุงูุนุชโูุง ูู ฺฉููู ุฏุงุดุชู ุจุงุดุฏ- ู ุงูฺฉู ฺุฑุง ุจู ุดฺฉู ูุนู ฺฉุงุฑ ู ฺฉูุฏ- ุชุง ุงูฺฉู ุจู ุฌูฺฏ ุขู ุจุฑูู ุง ููุงููุช ูพุฐุฑุด ุขู ุจุฎูุงูู ฺุฒ ุฏฺฏุฑ ุฑุง ุฏุฑุฎูุงุณุช ฺฉูู.


ุชุฌุฑุฏูุง ุฌุฏุฏ ู ุชูุงููุฏ ููุฏ ุจุงุดูุฏ. ูุฏู ูุคููู ู ุฑูุด ุฌุฑุงู ุฏุงุฏู ุง ฺฉู ูู ุฏุฑ ุงู ูุตู ุงุณุชูุงุฏู ฺฉุฑุฏู ุดฺฉู ุฎุงุต ุงุฒ ุขูโูุง ุจูุฏ. ููุงูุทูุฑ ฺฉู ุฐฺฉุฑ ุดุฏุ ฺฉุชุงุจุฎุงููโูุง ูุฌูุฏ ุฏุงุฑูุฏ ฺฉู ุจุงุนุซ ู ุดููุฏ ุจุฑูุงููโููุณ ุฑุงุจุท ฺฉุงุฑุจุฑ ุจุณุงุฑ ุฏููพุฐุฑ ุชุฑ ุจุดูุฏ. ุฏุฑ ุฒูุงู ููุดุชู ุงู ฺฉุชุงุจ ุ [React](https://reactjs.org/) ู [Angular](https://angular.io/) ุงูุชุฎุงุจโูุง ูพุฑุขูุงุฒูโุง ูุณุชูุฏ ุงูุง ุตูุนุช ูพุฑุชุญุฑฺฉ ุงุฒ ุงู ฺูุงุฑฺูุจโูุง ุฏุฑ ุญุงู ูุนุงูุช ู ุจุงุดุฏ. ุงฺฏุฑ ุจู ุจุฑูุงูู ููุณ ุงูพูฺฉุดูโูุง ูุจ ุนูุงูููุฏ ูุณุชุฏุ ูพุดููุงุฏ ู ฺฉูู ฺูุฏ ุชุง ุงุฒ ุขู ูุง ุฑุง ุจุฑุฑุณ ฺฉูุฏ ุชุง ุงุฒ ูุญููโ ฺฉุงุฑฺฉุฑุฏ ุขู ูุง ุจุงุฎุจุฑ ุดูุฏ ู ุจุจูุฏ ฺู ูุฒุงุง ุจุง ุฎูุฏ ู ุขูุฑูุฏ.

## ุชูุฑูโูุง

ุจุฑูุงููโ ูุง ูููุฒ ุฌุง ุจูุชุฑ ุดุฏู ุฏุงุฑุฏ. ุงุฌุงุฒู ุจุฏูุฏ ฺูุฏ ูฺฺฏ ุฌุฏุฏ ุจู ุนููุงู ุชูุฑู ุจู ุขู ุงุถุงูู ฺฉูู.


### ูุงูโุจุฑูุง ุตูุญูโฺฉูุฏ

{{index "keyboard bindings (exercise)"}}

ุจู ุจุฑูุงูู ูุงูุจุฑ ูุง ุตูุญู ฺฉูุฏ ุงุถุงูู ฺฉูุฏ. ุงููู ุญุฑู ูุฑ ุงุจุฒุงุฑ ุจุฑุง ุงูุชุฎุงุจ ุขู ุงุจุฒุงุฑ ู [control]{keyname}-Z ุง [command]{keyname}-Z ุจุฑุง ุงูุฌุงู ุฎูุซ ุณุงุฒ.


{{index "PixelEditor class", "tabindex attribute", "elt function", "keydown event"}}

ุงู ฺฉุงุฑ ุฑุง ุจุง ุงุฌุงุฏ ุชุบุฑ ุฏุฑ ูุคูููโ `PixelEditor` ุงูุฌุงู ุฏูุฏ. ุจู ุฎุงุตุช `tabIndex` ูุชุนูู ุจู ุนูุตุฑ ูพูุดุด `<div>` ุ ููุฏุงุฑ 0 ุฑุง ุงุนูุงู ฺฉูุฏ. ุฏุฑ ูุชุฌู ู ุชูุงูุฏ ุชูุณุท ุตูุญูโฺฉูุฏ ูุนุงู ุดูุฏ. ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุฎุงุตุช ูุฐฺฉูุฑ ฺฉู ุจู ุฎุตุตูโ `tabindex` ูุชูุงุธุฑ ุงุณุช `tabIndex` ุฎูุงูุฏู ู ุดูุฏ ฺฉู ุญุฑู ุงูู ุขู ุจุฒุฑฺฏ ุงุณุช ู ุชุงุจุน `elt` ูุง ูุงูโูุง ุฎุงุตุช ุฑุง ูุจูู ู ฺฉูุฏ. ฺฏุฑุฏุงููุฏูโูุง ุฑุฎุฏุงุฏูุง ุตูุญูโฺฉูุฏ ุฑุง ูุณุชููุง ุฑู ุขู ุนูุตุฑ ุซุจุช ฺฉูุฏ. ุนู ุจุงุฏ ฺฉูฺฉ ู ููุณ touch ุง tab ุฑู ุจุฑูุงูู ุงูุฌุงู ุดูุฏ ูุจู ุงุฒ ุงูฺฉู ุจุชูุงูุฏ ุจุง ุขู ุชูุณุท ุตูุญู ฺฉูุฏ ุชุนุงูู ฺฉูุฏ.

{{index "ctrlKey property", "metaKey property", "control key", "command key"}}

ุจู ุฎุงุทุฑ ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุฑุฎุฏุงุฏูุง ุตูุญูโฺฉูุฏ ุฏุงุฑุง ุฎุงุตุชโูุง `ctrlKey` ู `metaKeyโ` (ุจุฑุง ฺฉูุฏ [command]{keyname} ุฏุฑ ูฺฉ) ู ุจุงุดูุฏ ฺฉู ู ุชูุงูุฏ ุงุฒ ุขู ูุง ุจุฑุง ุงูฺฉู ุจุจูุฏ ุขุง ุงู ฺฉูุฏูุง ูพุงู ูฺฏูโุฏุงุดุชู ุดุฏู ุงูุฏ ุงุณุชูุงุฏู ฺฉูุฏ.

{{if interactive

```{test: no, lang: "text/html"}
<div></div>
<script>
  // The original PixelEditor class. Extend the constructor.
  class PixelEditor {
    constructor(state, config) {
      let {tools, controls, dispatch} = config;
      this.state = state;

      this.canvas = new PictureCanvas(state.picture, pos => {
        let tool = tools[this.state.tool];
        let onMove = tool(pos, this.state, dispatch);
        if (onMove) {
          return pos => onMove(pos, this.state, dispatch);
        }
      });
      this.controls = controls.map(
        Control => new Control(state, config));
      this.dom = elt("div", {}, this.canvas.dom, elt("br"),
                     ...this.controls.reduce(
                       (a, c) => a.concat(" ", c.dom), []));
    }
    syncState(state) {
      this.state = state;
      this.canvas.syncState(state.picture);
      for (let ctrl of this.controls) ctrl.syncState(state);
    }
  }

  document.querySelector("div")
    .appendChild(startPixelEditor({}));
</script>
```

if}}

{{hint

{{index "keyboard bindings (exercise)", "key property", "shift key"}}


ุฎุงุตุช `key` ูุชุนูู ุจู ุฑุฎุฏุงุฏโูุง ฺฉูุฏโูุง ุญุฑูู ููุงู ุญุฑูู ุจู ุดฺฉู ฺฉูฺฺฉ ุฎูุงููุฏ ุจูุฏุ ุงฺฏุฑ ฺฉูุฏ [shift]{keyname} ูุดุฑุฏู ุดุฏู ูุจุงุดุฏ. ุฏุฑ ุงูุฌุง ูุง ุจู ุฑุฎุฏุงุฏโูุง ฺฉูุฏูุง ฺฉู [shift]{keyname} ุฏุงุฑูุฏ ุชูุฌูโุง ููโฺฉูู.

{{index "keydown event"}}

ฺฉ ฺฏุฑุฏุงููุฏูโ `"keydown"` ู ุชูุงูุฏ ุดุก ุฑุฎุฏุงุฏุด ุฑุง ุจุฑุง ุชุทุจู ุจุง ูุงูโุจุฑูุง ุจุฑุฑุณ ฺฉูุฏ. ูโุชูุงูุฏ ูุณุช ุญุฑููโ ุงูู ุฑุง ุงุฒ ุดุก `tools` ุจู ุฏุณุช ุจุงูุฑุฏ ุชุง ูุงุฒ ูุจุงุดุฏ ุขูโูุง ุฑุง ุงุฒ ุงุจุชุฏุง ุจููุณุฏ.

{{index "preventDefault method"}}

ุฒูุงู ฺฉู ฺฉ ุฑุฎุฏุงุฏ ฺฉูุฏ ุจุง ฺฉ ูุงูุจุฑ ูุทุงุจูุช ุฏุงุฑุฏุ `preventDefault` ุฑุง ุฑู ุขู ูุฑุงุฎูุงู ฺฉูุฏ ู ุงฺฉุดู ููุงุณุจ ุจุง ุขู ุฑุง ฺฏุณู ุฏูุฏ.

hint}}

### ุชุฑุณู ุจููู

{{index "efficient drawing (exercise)", "canvas (HTML tag)", efficiency}}

ุฏุฑ ุทูู ุชุฑุณู ุจุดุชุฑู ฺฉุงุฑ ฺฉู ุจุฑูุงููโ ูุง ุงูุฌุงู ู ุฏูุฏ ุชูุณุท `drawPicture` ุตูุฑุช ู ฺฏุฑุฏ. ุงุฌุงุฏ ฺฉ ูุถุนุช ุฌุฏุฏ ู ุจูโุฑูุฒ ุฑุณุงู ูุง ุจู ูุณูุชโูุง DOM ฺฉุงุฑ ุฒุงุฏ ูพุฑูุฒููโุง ูุญุณูุจ ูู ุดูุฏุ ุงูุง ุจุงุฒููุงุด ุชูุงู ูพฺฉุณูโูุง ุฑู canvas ูุณุจุชุง ฺฉุงุฑ ู ุจุฑุฏ.

{{index "syncState method", "PictureCanvas class"}}

ุฑุงู ุจุงุจุฏ ฺฉู ูุชุฏ `syncState` ูุฑุจูุท ุจู PictureCanvas ุฑุง ุจุชูุงู ุจุง ุจุงุฒ ุชุฑุณู ุชููุง ูพฺฉุณูโูุง ฺฉู ูุงูุนุง ุชุบุฑ ูููุฏูโุงูุฏ ุณุฑุน ุชุฑ ฺฉุฑุฏ.


{{index "drawPicture function", compatibility}}

ุจู ุงุฏ ุฏุงุดุชู ุจุงุดุฏ ฺฉู `drawPicture` ุชูุณุท ุฏฺฉููโ ุฐุฎุฑูโุณุงุฒ ูุฒ ุงุณุชูุงุฏู ุดุฏู ุงุณุช ุจูุงุจุฑุงู ุงฺฏุฑ ุขู ุฑุง ุชุบุฑ ุฏูุฏ ูุทูุฆู ุดูุฏ ฺฉู ุชุบุฑุงุช ููุฌุจ ุงุฒ ฺฉุงุฑ ุงูุชุงุฏู ุขู ูู ุดูุฏ. ู ุชูุงู ูุณุฎูโ ุฌุฏุฏ ุงุฒ ุขู ุฑุง ุจุง ูุงู ุฏฺฏุฑ ุณุงุฎุช.

{{index "width property", "height property"}}

ููฺูู ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุชุบุฑ ุงูุฏุงุฒูโ ฺฉ ุนูุตุฑ `<canvas>`ุ ุชูุณุท ุชุบุฑ ุฎุงุตุชโูุง `width` ู `height` ุขูุ ุจุงุนุซ ู ุดูุฏ ฺฉู ุงุฒ ุตูุญู ูพุงฺฉ ุดูุฏ ู ุจู ุทูุฑ ฺฉุงูู ุจู ุตูุฑุช ุดูุงู ุฏุฑ ุจุงุฏ.


{{if interactive

```{test: no, lang: "text/html"}
<div></div>
<script>
  // Change this method
  PictureCanvas.prototype.syncState = function(picture) {
    if (this.picture == picture) return;
    this.picture = picture;
    drawPicture(this.picture, this.dom, scale);
  };

  // You may want to use or change this as well
  function drawPicture(picture, canvas, scale) {
    canvas.width = picture.width * scale;
    canvas.height = picture.height * scale;
    let cx = canvas.getContext("2d");

    for (let y = 0; y < picture.height; y++) {
      for (let x = 0; x < picture.width; x++) {
        cx.fillStyle = picture.pixel(x, y);
        cx.fillRect(x * scale, y * scale, scale, scale);
      }
    }
  }

  document.querySelector("div")
    .appendChild(startPixelEditor({}));
</script>
```

if}}

{{hint

{{index "efficient drawing (exercise)"}}

ุงู ุชูุฑู ูุซุงู ุฎูุจ ุงุณุช ฺฉู ูุดุงู ู ุฏูุฏ ฺฺฏููู ุณุงุฎุชุงุฑูุง ุฏุงุฏูโ ุบุฑูุงุจู ุชุบุฑ ู ุชูุงููุฏ ุจุงุนุซ ุณุฑุน ุชุฑ ุดุฏู ฺฉุฏ ุดููุฏ. ุจู ุฏูู ุงูฺฉู ูุง ุจู ูุฑ ุฏู ุชุตุงูุฑ ุฌุฏุฏ ู ูุฏู ุฏุณุชุฑุณ ุฏุงุฑูุ ู ุชูุงูู ุขูโูุง ุฑุง ููุงุณู ฺฉุฑุฏู ู ููุท ูพฺฉุณูโูุง ุฑุง ุจุงุฒุชุฑุณู ฺฉูู ฺฉู ุฑูฺฏุดุงู ุชุบุฑ ุงูุชู ุงุณุช ู ุงุฒ 99 ุฏุฑุตุฏ ุงุฒ ฺฉุงุฑ ุชุฑุณู ุงุถุงู ุจูพุฑูุฒู.

{{index "drawPicture function"}}

ุดูุง ููฺูู ู ุชูุงูุฏ ุชุงุจุน ุฌุฏุฏ `updatePicture` ุจููุณุฏ ุง ุจู `drawPicture` ุขุฑฺฏููุงู ุฌุฏุฏ ุงุถุงูู ฺฉูุฏ ฺฉู ูโุชูุงูุฏ undefined ุง ุจุฑุงุจุฑ ุชุตูุฑ ูุจู ุจุงุดุฏ. ุจุฑุง ูุฑ ูพฺฉุณูุ ุชุงุจุน ุจุฑุฑุณ ูโฺฉูุฏ ุขุง ุชุตูุฑ ุฏุงุฏูโุดุฏูโ ูุจู ุฏุฑ ุงู ูููุนุช ุฑูฺฏ ูุดุงุจู ุฏุงุฑุฏ ฺฉู ุฏุฑ ุงู ุตูุฑุช ุงุฒ ุขู ุฑุฏ ู ุดูุฏ.

{{index "width property", "height property", "canvas (HTML tag)"}}

ุจุง ุชูุฌู ุจู ุงูฺฉู canvas ุจุง ุชุบุฑ ุงูุฏุงุฒูุ ูพุงฺฉ ู ุดูุฏุ ุจุงุฏ ุงุฒ ุฏุณุชฺฉุงุฑ `width` ู โ`height` ุขู ุฏุฑ ุฒูุงู ฺฉู ุชุตูุฑ ูุฏู ู ุฌุฏุฏ ุงูุฏุงุฒูโ ูุดุงุจู ุฏุงุฑูุฏุ ุฎูุฏุฏุงุฑ ฺฉูุฏ. ุฏุฑ ุตูุฑุช ูุจูุฏ ุงูุฏุงุฒูโ ุจุฑุงุจุฑุ ฺฉู ุฏุฑ ููฺฏุงู ุจุงุฑฺฏุฑ ุชุตูุฑ ุฌุฏุฏ ุฑุฎ ู ุฏูุฏุ ู ุชูุงูุฏ ูุชุบุฑูุง ฺฉู ุชุตูุฑ ูุจู ุฑุง ูฺฏูโุฏุงุฑ ู ฺฉุฑุฏูุฏ ุฑุง ูพุณ ุงุฒ ุชุบุฑ ุงูุฏุงุฒูโ canvas ุจุฑุงุจุฑ null ูุฑุงุฑ ุฏูุฏ ุฒุฑุง ูุจุงุฏ ูฺ ูพฺฉุณู ูพุณ ุงุฒ ุชุบุฑ ุงูุฏุงุฒูโ canvas ุงุฒ ููู ุจูุชุฏ.

hint}}

### ุฏูุงุฑ

{{index "circles (exercise)", dragging}}

ุงุจุฒุงุฑ ุจู ูุงู `circle` ุชุนุฑู ฺฉูุฏ ฺฉู ุจุง ฺฉุดุฏู ุขู ุฑู ุจูู ุจุชูุงู ุฏุงุฑูโ ุชููพุฑ ุฑุณู ูููุฏ. ูุฑฺฉุฒ ุฏุงุฑู ุฏุฑ ูุณูุช ูุฑุงุฑ ุจฺฏุฑุฏ ฺฉู ุดุฑูุน ุฑุณู ุง ููุณ ูุฑุงุฑ ู ฺฏุฑุฏ ู ุดุนุงุน ุขู ุจุง ุญุฑฺฉุช ููุณ ูุนููู ู ุดูุฏ.


{{if interactive

```{test: no, lang: "text/html"}
<div></div>
<script>
  function circle(pos, state, dispatch) {
    // Your code here
  }

  let dom = startPixelEditor({
    tools: Object.assign({}, baseTools, {circle})
  });
  document.querySelector("div").appendChild(dom);
</script>
```

if}}

{{hint

{{index "circles (exercise)", "rectangle function"}}

ู ุชูุงูุฏ ุงุฒ ุงุจุฒุงุฑ `rectangleโ` ุงููุงู ฺฏุฑ ฺฉูุฏ. ุดุจู ุขู ุงุจุฒุงุฑุ ุฏุฑ ููฺฏุงู ุญุฑฺฉุช ุงุดุงุฑูโฺฏุฑ ููุณุ ู ุฎูุงูุฏ ุจู ุชุฑุณู ุฑู ุชุตูุฑ ุขุบุงุฒู ุงุฏุงูู ุฏูุฏ ูู ุชุตูุฑ ูุนู.

ุจุฑุง ุฏุณุชุงุจ ุจู ูพฺฉุณูโูุง ฺฉู ุจุงุณุช ุฑูฺฏ ุดููุฏุ ู ุชูุงูุฏ ุงุฒ ูุถูโ ูุซุงุบูุฑุณ ุงุณุชูุงุฏู ฺฉูุฏ. ุงุจุชุฏุง ูุงุตููโ ุจู ูููุนุช ุงุดุงุฑูโฺฏุฑ ูุนู ู ูููุนุช ุขุบุงุฒู ุฑุง ุจุง ูุญุงุณุจูโ ุฑุดูโ ุฏูู (`Math.sqrt`) ูุฌููุน ูุฑุจุนโูุง (`Math.pow(x,2)`) ุชูุงูุช ูุฎุชุตุงุช x ู ูุฑุจุน ุชูุงูุช ูุฎุชุตุงุช yุ ุจู ุฏุณุช ุจุงูุฑุฏ. ุณูพุณ ุณุฑุงุบ ูุฑุจุน ูพฺฉุณูโูุง ุงุทุฑุงู ููุทูโ ุขุบุงุฒู ุจุฑูุฏ ุจุง ุงู ุดุฑุท ฺฉู ุถูุนโุดุงู ุญุฏุงูู ุฏูุจุฑุงุจุฑ ุดุนุงุน ุจุงุดุฏุ ู ุขูโูุง ฺฉู ุฏุฑ ูุญุฏูุฏูโ ุดุนุงุน ูุฑุงุฑ ูโฺฏุฑูุฏ ุฑุง ุฑูฺฏ ฺฉูุฏุ ุจุง ุงุณุชูุงุฏู ุงุฒ ูุถูโ ูุซุงุบูุฑุณุ ูุงุตููโ ุขูโูุง ุฑุง ุงุฒ ูุฑฺฉุฒ ุจู ุฏุณุช ูโุขุฏ.

ุญูุงุณุชุงู ุจุงุดุฏ ฺฉู ูพฺฉุณูโูุง ฺฉู ุจุฑูู ุงุฒ ูุญุฏูุฏูโ ุชุตูุฑ ูุณุชูุฏ ุฑุง ุฑูฺฏ ูฺฉูุฏ.

hint}}

### ุฎุทูุท ุตุญุญ

{{index "proper lines (exercise)", "line drawing"}}

ุงู ุชูุฑู ุงุฒ ุฏู ุชูุฑู ูุจู ูพุดุฑูุชู ุชุฑ ุงุณุช ู ูุงุฒู ุงุณุช ุชุง ุฑุงู ุญู ุจุฑุง ูุณุฆููโุง ูู ฺูุฏุงู ุณุงุฏู ุทุฑุงุญ ฺฉูุฏ. ูุทูุฆู ุดูุฏ ฺฉู  ุฒูุงู ู ุตุจุฑ ฺฉุงู ุจุฑุง ุญู ุขู ูุจู ุงุฒ ฺฉุงุฑ ฺฉุฑุฏู ุฑู ุชูุฑูุ ุฏุฑ ุงุฎุชุงุฑ ุฏุงุฑุฏ ู ุงฺฏุฑ ุฏุฑ ุงุจุชุฏุง ฺฉุงุฑ ูููู ุจู ุญู ุขู ูุดุฏุฏ ูุง ุงูุฏ ูุดูุฏ.

{{index "draw function", "mousemove event", "touchmove event"}}

ุฏุฑ ุจุดุชุฑ ูุฑูุฑฺฏุฑูุงุ ุฒูุงู ฺฉู ุงุจุฒุงุฑ `draw` ุฑุง ุงูุชุฎุงุจ ู ฺฉูุฏ ู ุณุฑุน ุฑู ุชุตูุฑ ุจู ฺฉุดุฏู ู ูพุฑุฏุงุฒุฏุ ุฎุท ุจุณุชู ุชููุฏ ูู ุดูุฏ. ุฏุฑ ุนูุถ ุขูฺู ุฑุฎ ูุฏูุฏ ฺฉุดุฏู ุดุฏู ููุงุท ููุทุน ุงุณุช ฺฉู ุฏูู ุขู ุงู ุงุณุช ฺฉู ุฑุฎุฏุงุฏูุง `"mousemove"` ุง `"touchmove"` ุจู ุณุฑุนุช ู ูพ ุฏุฑ ูพ ุงุฌุงุฏ ูู ุดููุฏ ฺฉู ูููโ ูพฺฉุณูโูุง ุฑุง ูพูุดุด ุฏููุฏ.

ุงุจุฒุงุฑ `draw` ุฑุง ุจูุจูุฏ ุฏูุฏ ุชุง ุจุชูุงูุฏ ฺฉ ุฎุท ฺฉุงูู ุฑุง ุฑุณู ููุงุฏ. ุงู ุจู ุงู ูุนูุง ุงุณุช ฺฉู ุดูุง ุจุงุฏ ุชุงุจุน ฺฏุฑุฏุงููุฏูโ ุญุฑฺฉุช ุฑุง ุชุบุฑ ุฏูุฏ ุชุง ูููุนุช ูุจู ุฑุง ุจู ุฎุงุทุฑ ุฏุงุดุชู ุจุงุดุฏ ู ุขู ุฑุง ุจู ูููุนุช ูุนู ูุชุตู ฺฉูุฏ.

ุจุฑุง ุงูุฌุงู ุงู ฺฉุงุฑุ ุจู ุฏูู ุงูฺฉู ูพฺฉุณูโูุง ู ุชูุงููุฏ ุจุง ูุงุตููโ ุฏูุฎูุงู ูุงูุน ุดููุฏุ ูุงุฒู ุงุณุช ุชุง ฺฉ ุชุงุจุน ุนููู ุจุฑุง ุชุฑุณู ุฎุท ุจููุณุฏ.

ฺฉ ุฎุท ุจู ุฏู ููุทู ุชูุณุท ุฒูุฌุฑูโุง ุงุฒ ูพฺฉุณูโูุง ูุชุตู ุฑุณู ู ุดูุฏ ฺฉู ุชุง ุฌุง ููฺฉู ูุณุชูู ูุณุชูุฏ ู ุงุฒ ููุทูโ ุดุฑูุน ุจู ููุทูโ ูพุงุงู ูุฑุงุฑ ู ฺฏุฑูุฏ. ูพฺฉุณูโูุง ฺฉู ุจู ุตูุฑุช ูุทุฑ ูุฌุงูุฑ ูู ูุณุชูุฏ ุจู ุนููุงู ูพฺฉุณูโูุง ูุชุตู ูุญุณูุจ ู ุดููุฏ. ุจูุงุจุฑุงู ฺฉ ุฎุท ููุฑุจ ู ุชูุงูุฏ ุดุจุจู ุจู ุชุตูุฑ ุณูุช ฺูพ ุจุงุดุฏ ูู ุชุตูุฑ ุณูุช ุฑุงุณุช.

{{figure {url: "img/line-grid.svg", alt: "Two pixelated lines, one light, skipping across pixels diagonally, and one heavy, with all pixels connected horizontally or vertically", width: "6cm"}}}

ุฏุฑูุชุฌูุ ุงฺฏุฑ ฺฉุฏ ุฏุงุดุชู ุจุงุดู ฺฉู ฺฉ ุฎุท ุจู ุฏู ููุทูโ ุฏูุฎูุงู ุฑุณู ฺฉูุฏุ ููฺฉู ุงุณุช ููฺูู ุงุฏุงูู ุฏูู ู ุงุฒ ุขู ุจุฑุง ุชุนุฑู ฺฉ ุงุจุฒุงุฑ `line` ูุฒ ุจูุฑู ุจุจุฑู ฺฉู ุจุฑุง ุชุฑุณู ุฎุท ูุณุชูู ุจฺฉุงุฑ ู ุฑูุฏ.


{{if interactive

```{test: no, lang: "text/html"}
<div></div>
<script>
  // The old draw tool. Rewrite this.
  function draw(pos, state, dispatch) {
    function drawPixel({x, y}, state) {
      let drawn = {x, y, color: state.color};
      dispatch({picture: state.picture.draw([drawn])});
    }
    drawPixel(pos, state);
    return drawPixel;
  }

  function line(pos, state, dispatch) {
    // Your code here
  }

  let dom = startPixelEditor({
    tools: {draw, line, fill, rectangle, pick}
  });
  document.querySelector("div").appendChild(dom);
</script>
```

if}}

{{hint

{{index "proper lines (exercise)", "line drawing"}}


ููุถูุน ููู ุฏุฑุจุงุฑูโ ูุดฺฉู ุชุฑุณู ฺฉ ุฎุท ูพฺฉุณู ุงู ุงุณุช ฺฉู ุฏุฑ ูุงูุน ูุง ุจุง ฺูุงุฑ ูุณุฆูู ูุดุงุจู ุงูุง ฺฉู ูุชูุงูุช ุฑูุจุฑู ูุณุชู. ุฑุณู ฺฉ ุฎุท ุงูู ุงุฒ ฺูพ ุจู ุฑุงุณุช ุขุณุงู ุงุณุช - ูุฎุชุตุงุช x ุฑุง ูพูุงุด ู ฺฉูุฏ ู ุฏุฑ ูุฑ ฺฏุงู ฺฉ ูพฺฉุณู ุฑุง ุฑูฺฏ ู ฺฉูุฏ. ุงฺฏุฑ ุฎุท ุดุจ ฺฉู ุฏุงุดุชู ุจุงุดุฏ (ฺฉูุชุฑ ุงุฒ ดต ุฏุฑุฌู ุง ยผฯ ุฑุงุฏุงู )ุ ู ุชูุงูุฏ ูุฎุชุตุงุช y ุฑุง ุฏุฑ ุทูู ุฒุงูู ุฏุฑููโุงุจ ฺฉูุฏ. ูููุฒ ุจู ฺฉ ูพฺฉุณู ุจุฑุง ูุฑ ูููุนุช x ูุงุฒ ุฏุงุฑุฏ ฺุฑุงฺฉู ูุฎุชุตุงุช y ุขูโูุง ุชูุณุท ุดุจ ุชุนู ู ุดูุฏ.

ุงูุง ุจู ูุญุถ ุงูฺฉู ุดุจ ุดูุง ุจุดุชุฑ ุงุฒ 45 ุฏุฑุฌู ุดูุฏุ ุจุงุฏ ุฑูุด ุจุฑุฎูุฑุฏ ุจุง ูุฎุชุตุงุช ุฑุง ุนูุถ ฺฉูุฏ. ุงฺฉููู ุจู ฺฉ ูพฺฉุณู ุจุฑุง ูุฑ ูููุนุช y ูุงุฒ ุฏุงุฑุฏ ฺุฑุงฺฉู ุฎุท ุจุดุชุฑ ุจู ุจุงูุง ุญุฑฺฉุช ูโฺฉูุฏ ุชุง ุจู ฺูพ. ู ุฏุฑ ูุชุฌูุ ููุช ุงุฒ ุดุจ 135 ุฏุฑุฌู ุนุจูุฑ ู ฺฉูุฏุ ุจุงุฏ ุจู ูพูุงุด ูุฎุชุตุงุช x ุจุฑฺฏุฑุฏุฏ ุงูุง ุงุฒ ุฑุงุณุช ุจู ฺูพ.

ุฏุฑ ูุงูุน ูุงุฒ ูุณุช ฺฉู ฺูุงุฑ ุญููู ุจููุณุฏ. ุจุง ุชูุฌู ุจู ุงูฺฉู ุฑุณู ฺฉ ุฎุท ุงุฒ ููุทูโ A ุจู B ููุงููุฏ ุฑุณู ุฎุท ุงุฒ B ุจู A ูโุจุงุดุฏุ ูโุชูุงูุฏ ูููุนุชโูุง ุดุฑูุน ู ูพุงุงู ุฑุง ุจุฑุง ุฎุทูุท ฺฉู ุงุฒ ุฑุงุณุช ุจู ฺูพ ูโุฑููุฏ ุฌุงุจุฌุง ฺฉูุฏ ู ูุงููุฏ ฺูพ ุจู ุฑุงุณุช ุขูโูุง ุฑุง ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ.

ุจูุงุจุฑุงู ุจู ุฏู ุญูููโ ูุชูุงูุช ูุงุฒ ุฏุงุฑุฏ. ุงููู ฺุฒ ฺฉู ุชุงุจุน ุฑุณู ุฎุท ุดูุง ุจุงุฏ ุงูุฌุงู ุฏูุฏ ุงู ุงุณุช ฺฉู ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุชูุงูุช ูุฎุชุตุงุช x ุจุฒุฑฺฏโุชุฑ ุงุฒ ุชูุงูุช ูุฎุชุตุงุช y ุจุงุดุฏ. ุงฺฏุฑ ุงู ุทูุฑ ุจูุฏุ ุงู ุฎุทุ ุฎุท ุงูู ุดฺฉู ุงุณุช ู ุงฺฏุฑ ูุจูุฏุ ุนูู ุดฺฉู ู ุจุงุดุฏ.

{{index "Math.abs function", "absolute value"}}

ุงุทููุงู ุญุงุตู ฺฉูุฏ ฺฉู ูุฏุฑ ูุทูู ุชูุงูุช ููุงุฏุฑ x ู y ุฑุง ููุงุณู ู ฺฉูุฏ ฺฉู ู ุชูุงู ุงู ฺฉุงุฑ ุฑุง ุจุง <bdo>`Math.abs`</bdo> ุงูุฌุงู ุฏุงุฏ.

{{index "swapping bindings"}}

ุจู ูุญุถ ุงูฺฉู ุจุฏุงูุฏ ุญูู ฺฉุฏุงู ูุญูุฑ ูพูุงุด ุฎูุงูุฏ ุฏุงุดุชุ ู ุชูุงูุฏ ุจุฑุฑุณ ฺฉูุฏ ฺฉู ููุทูโ ุดุฑูุน ุฏุงุฑุง ูุฎุชุตุงุช ุจุงูุงุชุฑ ุฏุฑ ุทูู ุขู ูุญูุฑ ูุณุจุช ุจู ููุทูโ ูพุงุงู ุจุงุดุฏ ู ุฏุฑ ุตูุฑุช ูุงุฒ ุขูโูุง ุฑุง ุฌุงุจุฌุง ฺฉูุฏ. ฺฉ ุฑูุด ูุฎุชุตุฑ ุจุฑุง ุฌุงุจุฌุง ููุงุฏุฑ ุฏู ูุชุบุฑ ุฏุฑ ุฌุงูุงุงุณฺฉุฑูพุช ุงุณุชูุงุฏู ุงุฒ ุงูุชุณุงุจ ู ุชุฎุฑุจ ุจู ุดฺฉู ุฒุฑ ุงุณุช:


```{test: no}
[start, end] = [end, start];
```

{{index rounding}}

ุงฺฉููู ู ุชูุงูุฏ ุดุจ ุฎุท ุฑุง ูุญุงุณุจู ููุงุฏุ ฺฉู ุฎูุฏ ููุฏุงุฑ ฺฉู ูุฎุชุตุงุช ุฑู ุฏฺฏุฑ ูุญูุฑ ุชุบุฑ ู ฺฉูุฏ ุฑุง ุจุฑุง ูุฑ ฺฏุงู ฺฉู ุฑู ูุญูุฑ ุงุตู ุจุฑูโุฏุงุฑุฏุ ุชุนู ู ููุงุฏ. ุจุง ุงุณุชูุงุฏู ุงุฒ ุขูุ ู ุชูุงูุฏ ุงุฒ ฺฉ ุญููู ุจุฑุง ูุญูุฑ ุงุตู ุงุณุชูุงุฏู ฺฉูุฏ ู ุฏุฑ ุญู ุขู ูููุนุช ูุชูุงุธุฑ ุฑู ูุญูุฑ ุฏฺฏุฑ ุฑุง ูุฒ ุฑุตุฏ ฺฉูุฏุ ู ู ุชูุงูุฏ ูพฺฉุณูโูุง ุฑุง ุฏุฑ ูุฑ ฺฏุงู ุญููู ุฑุณู ฺฉูุฏ. ูุทูุฆู ุดูุฏ ฺฉู ูุฎุชุตุงุช ูุญูุฑ ุบุฑุงุตู ุฑุง ุฑูุฏ ููุงุฏ ฺุฑุงฺฉู ุงุญุชูุงูุง ุงุนุดุงุฑ ุจุงุดูุฏ ู ูุชุฏ `draw`ุจู ูุฎุชุตุงุช ุงุนุดุงุฑ ูพุงุณุฎ ุฎูุจ ูู ุฏูุฏ.


hint}}
